(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var s=e.g.document;if(!t&&s&&(s.currentScript&&(t=s.currentScript.src),!t)){var i=s.getElementsByTagName("script");if(i.length)for(var a=i.length-1;a>-1&&!t;)t=i[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t=class{constructor(e,t,s,i,a,h){this.bar=new Phaser.GameObjects.Graphics(e),this.x=t,this.y=s,this.maxLife=i,this.currentHealth=i,this.percent=1,this.width=a||80,this.height=h||14,this.draw(),e.add.existing(this.bar)}decrease(e){this.currentHealth-=e,this.currentHealth<0&&(this.currentHealth=0),this.percent=this.currentHealth/this.maxLife,this.draw()}draw(){this.bar.clear(),this.bar.fillStyle(16777215),this.bar.fillRect(this.x+2,this.y+2,this.width,this.height),this.percent<.3?this.bar.fillStyle(16711680):this.bar.fillStyle(65280);var e=Math.floor(this.percent*this.width);this.bar.fillRect(this.x+2,this.y+2,e,this.height)}},s=class{constructor(e,t,s,i){this.x=t,this.y=s,this.maxLives=i,this.currentLives=i,this.hearts=e.add.group({key:"heart",repeat:this.maxLives-1,setXY:{x:this.x,y:this.y,stepX:32}})}decrease(e){this.currentLives-=e,this.currentLives<0&&(this.currentLives=0),this.hearts.getChildren().forEach(((e,t)=>{e.setVisible(t<this.currentLives)}))}},i=class{constructor(e,t,i,a,h,r){this.speed=a,this.weapon=h,this.health=r,this.sprite=e.physics.add.sprite(t,i,"player"),this.sprite.setCollideWorldBounds(!0),this.sprite.player=this,this.hearts=new s(e,30,830,this.health),this.explosion=e.physics.add.sprite(this.sprite.x,this.sprite.y,"explosion")}setSpeed=e=>{this.speed=e};setWeapons=e=>{this.weapon=e};setVelocityX=e=>{this.sprite.setVelocityX(e)};setVelocityY=e=>{this.sprite.setVelocityY(e)};decreaseLife(e){alert("oops"),this.sprite.scene.tweens.add({targets:this.sprite,x:this.sprite.x+Phaser.Math.Between(-10,10),y:this.sprite.y+Phaser.Math.Between(-10,10),duration:100,repeat:5,ease:"Linear",alpha:0,yoyo:!0})}destroy(){this.explosion.play("explode"),this.sprite.destroy()}},a=e.p+"bb6ca2cb56b8adeeb008.png",h=e.p+"c0d3e7fd64b625820d64.png",r=e.p+"6f9d937e56f3be8b48c1.png",l=e.p+"773632788d3c5029a4d8.png",o=e.p+"9d6cef2631e050830245.png",n=e.p+"05bd5dbfa1e869a44f4d.png",p=e.p+"e519d73b7a7adf06c762.png",d=e.p+"aa016ede56a3bd62725e.png",c=e.p+"b731a2c802783424d4ad.wav",y=e.p+"6654ea4cc92416626e7a.wav",u=e.p+"9d38b45d785aa2e094da.wav",g=e.p+"95f835c0e1e77b8ae93a.wav",f=e.p+"90d9fdaff3aef363eb64.png",b=e.p+"80fbe404e9e7ebcae073.png",w=e.p+"ce12f49b243e2b0153f3.png",m={type:Phaser.AUTO,width:1500,height:900,physics:{default:"arcade",arcade:{gravity:{y:0}}},scene:{preload:function(){this.load.image("player",a),this.load.image("heart",h),this.load.image("bullet",r),this.load.image("playerBullet",l),this.load.image("alien",n),this.load.image("bossAlien",p),this.load.image("bossAlienBullet",o),this.load.image("space",d),this.load.image("x2Upgrade",w),this.load.audio("explosionSound",c),this.load.audio("shootSound",y),this.load.audio("impactScreamSound",u),this.load.audio("level1Music",g),this.load.spritesheet("player-1-explosion",f,{frameWidth:230,frameHeight:125,endFrame:9}),this.load.spritesheet("boss-alien-explosion",b,{frameWidth:600,frameHeight:420,endFrame:10})},create:function(){V=this.add.tileSprite(0,0,1500,900,"space"),V.setOrigin(0,0),x=new i(this,m.width/2,m.height-150,H.playerSpeed,H.playerWeapon,H.playerHealth),v=this.input.keyboard.createCursorKeys(),S=this.physics.add.group(),B=this.physics.add.group();class e extends Phaser.Physics.Arcade.Sprite{constructor(e,t,s,i,a){super(e,0,0,t),this.scene=e,this.shootDelay=s,this.movementSpeed=i,this.spawning=a,this.scene.physics.world.enable(this),this.spawning||this.startShooting(),this.spawning||this.startMoving(),this.dropUpgrade={x2:()=>{let e=A.create(this.x,this.y,"x2Upgrade");e.enable=e=>{e.setSpeed(1.5*H.playerSpeed),e.setWeapons("double-bullets")},e.expire=e=>{e.setSpeed(H.playerSpeed),e.setWeapons("bullets")},e.setVelocityY(200)}}}setup(e,t){this.setPosition(e,t),this.setActive(!0),this.setVisible(!0)}startShooting(){if(E.get("noAlienShooting"))return;let e=()=>{S.create(this.x,this.y+this.height/2,"bullet").setVelocityY(300),this.active&&(this.nextShootEvent=this.scene.time.delayedCall(Phaser.Math.Between(350,this.shootDelay),e,[],this))},t=Phaser.Math.Between(0,this.shootDelay);this.nextShootEvent=this.scene.time.delayedCall(t,e,[],this)}startMoving(){let e=()=>{if(!this.active)return;let t,s=Phaser.Math.Between(-1,1),i=Phaser.Math.Between(0,100),a=this.x+s*i;(a>this.scene.game.config.width-this.width||a<0)&&(a=this.x),t=this.healthBar?[this,this.healthBar.bar]:[this],this.scene.tweens.add({targets:t,x:a,duration:this.movementSpeed,ease:"Linear",onComplete:this.active?e:null})},t=Phaser.Math.Between(0,this.movementSpeed);this.nextMoveEvent=this.scene.time.delayedCall(t,e,[],this)}}class s extends e{constructor(e){super(e,"bossAlien",1800,400,!0),this.life=20,this.healthBar=new t(this.scene,this.x-41,this.y+40,this.life)}setup(e,t){this.setPosition(e,-100),this.spawning=!0,this.scene.tweens.add({targets:this,y:t,duration:1300,ease:"Linear",onComplete:()=>{this.startMoving(),this.startShooting(),this.spawning=!1}}),this.setActive(!0),this.setVisible(!0)}setLife(e){this.healthBar.decrease(this.life-e),this.life=e}startShooting(){if(E.get("noAlienShooting"))return;let e=()=>{if(!this.active)return;let t=S.create(this.x,this.y+this.height/2-70,"bossAlienBullet"),s=Phaser.Math.Angle.Between(this.x,this.y,x.sprite.x,x.sprite.y),i=350*Math.cos(s),a=350*Math.sin(s);t.setVelocity(i,a),this.active&&(this.nextShootEvent=this.scene.time.delayedCall(Phaser.Math.Between(270,this.shootDelay),e,[],this))};e()}}let a=this.physics.add.group({classType:class extends e{constructor(e){super(e,"alien",4300,1200)}}});for(let e=0;e<H.regularAliens;e++)a.get().setup(100+130*e,100);A=this.physics.add.group(),P=this.sound.add("explosionSound"),M=this.sound.add("shootSound"),C=this.sound.add("impactScreamSound"),"true"!==E.get("noMusic")&&(L||(L=this.sound.add("level1Music"),L.setVolume(.8),L.play())),"true"===E.get("dropUpgrades")&&a.getChildren()[5].dropUpgrade.x2(),this.anims.create({key:"explode",frames:this.anims.generateFrameNumbers("player-1-explosion",{start:0,end:8,first:0}),frameRate:23,repeat:0,hideOnComplete:!0}),this.anims.create({key:"bossAlienExplode",frames:this.anims.generateFrameNumbers("boss-alien-explosion",{start:0,end:10,first:0}),frameRate:23,repeat:0,hideOnComplete:!0}),this.physics.add.overlap(B,a,(function(e,t){e.destroy(),P.play(),t.nextShootEvent&&t.nextShootEvent.remove(),t.destroy(),Phaser.Math.Between(0,100)>80&&t.dropUpgrade.x2();let i=!1;if(a.getChildren().forEach((e=>{e.active&&(i=!0)})),!1===i&&x.sprite.active){let e=this.physics.add.group({classType:s});Y=e.get(),Y.setup(m.width/2,170),this.physics.add.overlap(Y,B,(function(e,t){if(t.destroy(),!e.spawning&&(e.setLife(e.life-1),0===e.life&&x.sprite.active)){e.destroy(),e.healthBar.bar.destroy(),this.physics.add.sprite(e.x,e.y,"bossAlienExplode").play("bossAlienExplode"),P.play();let t=this.add.text(0,0,"You win!",{font:'64px "Arial Black", "Arial Bold", "Arial", sans-serif',fill:"#fff"}).setOrigin(.5,.5).setPosition(m.width/2,m.height/2).setVisible(!1);this.time.delayedCall(900,(function(){t.setVisible(!0)}),[],this)}}),null,this)}}),null,this),this.physics.add.overlap(x.sprite,S,(function(e,t){if(e.player.decreaseLife(1),t.destroy(),C.play(),x.health>0)return;t.destroy(),x.destroy();let s=this.add.text(0,0,"You lose",{font:'64px "Arial Black", "Arial Bold", "Arial", sans-serif',fill:"#fff"}).setOrigin(.5,.5).setPosition(m.width/2,m.height/2).setVisible(!1),i=this.add.text(0,0,"Hit <Space> to restart",{font:'34px "Arial Black", "Arial Bold", "Arial", sans-serif',fill:"#fff"}).setOrigin(.5,.5).setPosition(m.width/2,m.height/2+100).setVisible(!1);this.time.delayedCall(600,(function(){s.setVisible(!0)}),[],this),this.time.delayedCall(2100,(function(){i.setVisible(!0),D=!0}),[],this)}),null,this),this.physics.add.overlap(x.sprite,A,(function(e,t){t.enable(e.player),t.destroy(),this.time.delayedCall(3500,(function(){t.expire(e.player)}),[],this)}),null,this)},update:function(){x.sprite.active&&(v.left.isDown?x.setVelocityX(-x.speed):v.right.isDown?x.setVelocityX(x.speed):v.down.isDown?x.setVelocityY(x.speed):v.up.isDown?x.setVelocityY(-x.speed):(x.setVelocityX(0),x.setVelocityY(0))),Phaser.Input.Keyboard.JustDown(v.space)&&(x.sprite.active?"bullets"===x.weapon?(B.create(x.sprite.x,x.sprite.y-x.sprite.height+40,"playerBullet").setVelocityY(-x.speed),M.play()):"double-bullets"===x.weapon&&(B.create(x.sprite.x-20,x.sprite.y-x.sprite.height+40,"playerBullet").setVelocityY(-x.speed),B.create(x.sprite.x+20,x.sprite.y-x.sprite.height+40,"playerBullet").setVelocityY(-x.speed),M.play()):D&&(D=!1,this.scene.restart())),V.tilePositionY-=1.1}}};let x,v,S,B,A,V,P,M,C,L,Y,E=new URLSearchParams(window.location.search),H={playerSpeed:330,playerWeapon:"bullets",playerHealth:3,regularAliens:E.get("regularAliens")?E.get("regularAliens"):11},D=(new Phaser.Game(m),!1)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQ0EsSUFBSUEsRUFBc0IsQ0FBQyxFQ0QzQkEsRUFBb0JDLEVBQUksV0FDdkIsR0FBMEIsaUJBQWZDLFdBQXlCLE9BQU9BLFdBQzNDLElBQ0MsT0FBT0MsTUFBUSxJQUFJQyxTQUFTLGNBQWIsRUFDaEIsQ0FBRSxNQUFPQyxHQUNSLEdBQXNCLGlCQUFYQyxPQUFxQixPQUFPQSxNQUN4QyxDQUNBLENBUHVCLEcsTUNBeEIsSUFBSUMsRUFDQVAsRUFBb0JDLEVBQUVPLGdCQUFlRCxFQUFZUCxFQUFvQkMsRUFBRVEsU0FBVyxJQUN0RixJQUFJQyxFQUFXVixFQUFvQkMsRUFBRVMsU0FDckMsSUFBS0gsR0FBYUcsSUFDYkEsRUFBU0MsZ0JBQ1pKLEVBQVlHLEVBQVNDLGNBQWNDLE1BQy9CTCxHQUFXLENBQ2YsSUFBSU0sRUFBVUgsRUFBU0kscUJBQXFCLFVBQzVDLEdBQUdELEVBQVFFLE9BRVYsSUFEQSxJQUFJQyxFQUFJSCxFQUFRRSxPQUFTLEVBQ2xCQyxHQUFLLElBQU1ULEdBQVdBLEVBQVlNLEVBQVFHLEtBQUtKLEdBRXhELENBSUQsSUFBS0wsRUFBVyxNQUFNLElBQUlVLE1BQU0seURBQ2hDVixFQUFZQSxFQUFVVyxRQUFRLE9BQVEsSUFBSUEsUUFBUSxRQUFTLElBQUlBLFFBQVEsWUFBYSxLQUNwRmxCLEVBQW9CbUIsRUFBSVosQyxLQytCeEIsUUFqREEsTUFDRSxXQUFBYSxDQUFZQyxFQUFPQyxFQUFHQyxFQUFHQyxFQUFTQyxFQUFPQyxHQUN2Q3ZCLEtBQUt3QixJQUFNLElBQUlDLE9BQU9DLFlBQVlDLFNBQVNULEdBRTNDbEIsS0FBS21CLEVBQUlBLEVBQ1RuQixLQUFLb0IsRUFBSUEsRUFDVHBCLEtBQUtxQixRQUFVQSxFQUNmckIsS0FBSzRCLGNBQWdCUCxFQUNyQnJCLEtBQUs2QixRQUFVLEVBRWY3QixLQUFLc0IsTUFBUUEsR0FBUyxHQUN0QnRCLEtBQUt1QixPQUFTQSxHQUFVLEdBRXhCdkIsS0FBSzhCLE9BRUxaLEVBQU1hLElBQUlDLFNBQVNoQyxLQUFLd0IsSUFDMUIsQ0FFQSxRQUFBUyxDQUFTQyxHQUNQbEMsS0FBSzRCLGVBQWlCTSxFQUVsQmxDLEtBQUs0QixjQUFnQixJQUN2QjVCLEtBQUs0QixjQUFnQixHQUd2QjVCLEtBQUs2QixRQUFVN0IsS0FBSzRCLGNBQWdCNUIsS0FBS3FCLFFBQ3pDckIsS0FBSzhCLE1BQ1AsQ0FFQSxJQUFBQSxHQUNFOUIsS0FBS3dCLElBQUlXLFFBR1RuQyxLQUFLd0IsSUFBSVksVUFBVSxVQUNuQnBDLEtBQUt3QixJQUFJYSxTQUFTckMsS0FBS21CLEVBQUksRUFBR25CLEtBQUtvQixFQUFJLEVBQUdwQixLQUFLc0IsTUFBT3RCLEtBQUt1QixRQUV2RHZCLEtBQUs2QixRQUFVLEdBQ2pCN0IsS0FBS3dCLElBQUlZLFVBQVUsVUFFbkJwQyxLQUFLd0IsSUFBSVksVUFBVSxPQUlyQixJQUFJRSxFQUFJQyxLQUFLQyxNQUFNeEMsS0FBSzZCLFFBQVU3QixLQUFLc0IsT0FFdkN0QixLQUFLd0IsSUFBSWEsU0FBU3JDLEtBQUttQixFQUFJLEVBQUduQixLQUFLb0IsRUFBSSxFQUFHa0IsRUFBR3RDLEtBQUt1QixPQUNwRCxHQ2pCRixFQTdCQSxNQUNFLFdBQUFOLENBQVlDLEVBQU9DLEVBQUdDLEVBQUdxQixHQUN2QnpDLEtBQUttQixFQUFJQSxFQUNUbkIsS0FBS29CLEVBQUlBLEVBQ1RwQixLQUFLeUMsU0FBV0EsRUFDaEJ6QyxLQUFLMEMsYUFBZUQsRUFFcEJ6QyxLQUFLMkMsT0FBU3pCLEVBQU1hLElBQUlhLE1BQU0sQ0FDNUJDLElBQUssUUFDTEMsT0FBUTlDLEtBQUt5QyxTQUFXLEVBQ3hCTSxNQUFPLENBQUU1QixFQUFHbkIsS0FBS21CLEVBQUdDLEVBQUdwQixLQUFLb0IsRUFBRzRCLE1BQU8sS0FFMUMsQ0FFQSxRQUFBZixDQUFTQyxHQUNQbEMsS0FBSzBDLGNBQWdCUixFQUdqQmxDLEtBQUswQyxhQUFlLElBQ3RCMUMsS0FBSzBDLGFBQWUsR0FJdEIxQyxLQUFLMkMsT0FBT00sY0FBY0MsU0FBUSxDQUFDQyxFQUFPQyxLQUN4Q0QsRUFBTUUsV0FBV0QsRUFBUXBELEtBQUswQyxhQUFhLEdBRS9DLEdDaUNGLEVBekRBLE1BQ0UsV0FBQXpCLENBQVlDLEVBQU9DLEVBQUdDLEVBQUdrQyxFQUFhQyxFQUFjQyxHQUNsRHhELEtBQUt5RCxNQUFRSCxFQUNidEQsS0FBSzBELE9BQVNILEVBQ2R2RCxLQUFLMkQsT0FBU0gsRUFFZHhELEtBQUs0RCxPQUFTMUMsRUFBTTJDLFFBQVE5QixJQUFJNkIsT0FBT3pDLEVBQUdDLEVBQUcsVUFDN0NwQixLQUFLNEQsT0FBT0UsdUJBQXNCLEdBQ2xDOUQsS0FBSzRELE9BQU9HLE9BQVMvRCxLQUVyQkEsS0FBSzJDLE9BQVMsSUFBSSxFQUFPekIsRUFBTyxHQUFJLElBQUtsQixLQUFLMkQsUUFFOUMzRCxLQUFLZ0UsVUFBWTlDLEVBQU0yQyxRQUFROUIsSUFBSTZCLE9BQ2pDNUQsS0FBSzRELE9BQU96QyxFQUNabkIsS0FBSzRELE9BQU94QyxFQUNaLFlBRUosQ0FFQTZDLFNBQVlSLElBQ1Z6RCxLQUFLeUQsTUFBUUEsQ0FBSyxFQUdwQlMsV0FBY1IsSUFDWjFELEtBQUswRCxPQUFTQSxDQUFNLEVBR3RCUyxhQUFnQkMsSUFDZHBFLEtBQUs0RCxPQUFPTyxhQUFhQyxFQUFTLEVBR3BDQyxhQUFnQkQsSUFDZHBFLEtBQUs0RCxPQUFPUyxhQUFhRCxFQUFTLEVBR3BDLFlBQUFFLENBQWFwQyxHQUNYcUMsTUFBTSxRQUlOdkUsS0FBSzRELE9BQU8xQyxNQUFNc0QsT0FBT3pDLElBQUksQ0FDM0IwQyxRQUFTekUsS0FBSzRELE9BQ2R6QyxFQUFHbkIsS0FBSzRELE9BQU96QyxFQUFJTSxPQUFPYyxLQUFLbUMsU0FBUyxHQUFJLElBQzVDdEQsRUFBR3BCLEtBQUs0RCxPQUFPeEMsRUFBSUssT0FBT2MsS0FBS21DLFNBQVMsR0FBSSxJQUM1Q0MsU0FBVSxJQUNWN0IsT0FBUSxFQUNSOEIsS0FBTSxTQUNOQyxNQUFPLEVBQ1BDLE1BQU0sR0FFVixDQUVBLE9BQUFDLEdBQ0UvRSxLQUFLZ0UsVUFBVWdCLEtBQUssV0FDcEJoRixLQUFLNEQsT0FBT21CLFNBQ2QsRywrZUM1QklFLEVBQVMsQ0FDYkMsS0FBTXpELE9BQU8wRCxLQUNiN0QsTUFBTyxLQUNQQyxPQUFRLElBQ1JzQyxRQUFTLENBQ1B1QixRQUFTLFNBQ1RDLE9BQVEsQ0FDTkMsUUFBUyxDQUFFbEUsRUFBRyxLQUdsQkYsTUFBTyxDQUNMcUUsUUE2QkosV0FDRXZGLEtBQUt3RixLQUFLQyxNQUFNLFNBQVUsR0FDMUJ6RixLQUFLd0YsS0FBS0MsTUFBTSxRQUFTLEdBQ3pCekYsS0FBS3dGLEtBQUtDLE1BQU0sU0FBVSxHQUMxQnpGLEtBQUt3RixLQUFLQyxNQUFNLGVBQWdCLEdBQ2hDekYsS0FBS3dGLEtBQUtDLE1BQU0sUUFBUyxHQUN6QnpGLEtBQUt3RixLQUFLQyxNQUFNLFlBQWEsR0FDN0J6RixLQUFLd0YsS0FBS0MsTUFBTSxrQkFBbUIsR0FDbkN6RixLQUFLd0YsS0FBS0MsTUFBTSxRQUFTLEdBQ3pCekYsS0FBS3dGLEtBQUtDLE1BQU0sWUFBYSxHQUM3QnpGLEtBQUt3RixLQUFLRSxNQUFNLGlCQUFrQixHQUNsQzFGLEtBQUt3RixLQUFLRSxNQUFNLGFBQWMsR0FDOUIxRixLQUFLd0YsS0FBS0UsTUFBTSxvQkFBcUIsR0FDckMxRixLQUFLd0YsS0FBS0UsTUFBTSxjQUFlLEdBQy9CMUYsS0FBS3dGLEtBQUtHLFlBQVkscUJBQXNCLEVBQXdCLENBQ2xFQyxXQUFZLElBQ1pDLFlBQWEsSUFDYkMsU0FBVSxJQUVaOUYsS0FBS3dGLEtBQUtHLFlBQVksdUJBQXdCLEVBQTBCLENBQ3RFQyxXQUFZLElBQ1pDLFlBQWEsSUFDYkMsU0FBVSxJQUVkLEVBcERJQyxPQXNESixXQUlFQyxFQUFLaEcsS0FBSytCLElBQUlrRSxXQUFXLEVBQUcsRUFBRyxLQUFNLElBQUssU0FDMUNELEVBQUdFLFVBQVUsRUFBRyxHQUVoQixFQUFTLElBQUksRUFDWGxHLEtBQ0FpRixFQUFPM0QsTUFBUSxFQUNmMkQsRUFBTzFELE9BQVMsSUFDaEI0RSxFQUFhN0MsWUFDYjZDLEVBQWE1QyxhQUNiNEMsRUFBYTNDLGNBTWY0QyxFQUFVcEcsS0FBS3FHLE1BQU1DLFNBQVNDLG1CQUM5QkMsRUFBZXhHLEtBQUs2RCxRQUFROUIsSUFBSWEsUUFDaEM2RCxFQUFnQnpHLEtBQUs2RCxRQUFROUIsSUFBSWEsUUFLakMsTUFBTThELFVBQWNqRixPQUFPa0YsUUFBUUMsT0FBT0MsT0FDeEMsV0FBQTVGLENBQVlDLEVBQU80RixFQUFTQyxFQUFZQyxFQUFlQyxHQUNyREMsTUFBTWhHLEVBQU8sRUFBRyxFQUFHNEYsR0FDbkI5RyxLQUFLa0IsTUFBUUEsRUFDYmxCLEtBQUsrRyxXQUFhQSxFQUNsQi9HLEtBQUtnSCxjQUFnQkEsRUFDckJoSCxLQUFLaUgsU0FBV0EsRUFFaEJqSCxLQUFLa0IsTUFBTTJDLFFBQVFzRCxNQUFNQyxPQUFPcEgsTUFFM0JBLEtBQUtpSCxVQUNSakgsS0FBS3FILGdCQUVGckgsS0FBS2lILFVBQVVqSCxLQUFLc0gsY0FFekJ0SCxLQUFLdUgsWUFBYyxDQUNqQkMsR0FBSSxLQUNGLElBQUlDLEVBQVVDLEVBQVMzQixPQUFPL0YsS0FBS21CLEVBQUduQixLQUFLb0IsRUFBRyxhQUM5Q3FHLEVBQVFMLE9BQVVyRCxJQUNoQkEsRUFBT0UsU0FBb0MsSUFBM0JrQyxFQUFhN0MsYUFDN0JTLEVBQU9HLFdBQVcsaUJBQWlCLEVBRXJDdUQsRUFBUUUsT0FBVTVELElBQ2hCQSxFQUFPRSxTQUFTa0MsRUFBYTdDLGFBQzdCUyxFQUFPRyxXQUFXLFVBQVUsRUFFOUJ1RCxFQUFRcEQsYUFBYSxJQUFJLEVBRy9CLENBRUEsS0FBQXVELENBQU16RyxFQUFHQyxHQUNQcEIsS0FBSzZILFlBQVkxRyxFQUFHQyxHQUNwQnBCLEtBQUs4SCxXQUFVLEdBQ2Y5SCxLQUFLcUQsWUFBVyxFQUVsQixDQUVBLGFBQUFnRSxHQUNFLEdBQUlVLEVBQU9DLElBQUksbUJBQW9CLE9BQ25DLElBQUlDLEVBQVEsS0FDR3pCLEVBQWFULE9BQ3hCL0YsS0FBS21CLEVBQ0xuQixLQUFLb0IsRUFBSXBCLEtBQUt1QixPQUFTLEVBQ3ZCLFVBRUs4QyxhQUFhLEtBRWhCckUsS0FBS2tJLFNBQ1BsSSxLQUFLbUksZUFBaUJuSSxLQUFLa0IsTUFBTWtILEtBQUtDLFlBQ3BDNUcsT0FBT2MsS0FBS21DLFFBQVEsSUFBSzFFLEtBQUsrRyxZQUM5QmtCLEVBQ0EsR0FDQWpJLE1BRUosRUFJRXNJLEVBQWU3RyxPQUFPYyxLQUFLbUMsUUFBUSxFQUFHMUUsS0FBSytHLFlBQy9DL0csS0FBS21JLGVBQWlCbkksS0FBS2tCLE1BQU1rSCxLQUFLQyxZQUNwQ0MsRUFDQUwsRUFDQSxHQUNBakksS0FFSixDQUVBLFdBQUFzSCxHQUNFLElBQUlpQixFQUFPLEtBQ1QsSUFBS3ZJLEtBQUtrSSxPQUFRLE9BRWxCLElBU0l6RCxFQVRBK0QsRUFBWS9HLE9BQU9jLEtBQUttQyxTQUFTLEVBQUcsR0FDcEMrRCxFQUFXaEgsT0FBT2MsS0FBS21DLFFBQVEsRUFBRyxLQUdsQ2dFLEVBQVMxSSxLQUFLbUIsRUFBSXFILEVBQVlDLEdBQzlCQyxFQUFTMUksS0FBS2tCLE1BQU15SCxLQUFLMUQsT0FBTzNELE1BQVF0QixLQUFLc0IsT0FBU29ILEVBQVMsS0FDakVBLEVBQVMxSSxLQUFLbUIsR0FLZHNELEVBREV6RSxLQUFLNEksVUFDRyxDQUFDNUksS0FBTUEsS0FBSzRJLFVBQVVwSCxLQUV0QixDQUFDeEIsTUFJYkEsS0FBS2tCLE1BQU1zRCxPQUFPekMsSUFBSSxDQUNwQjBDLFFBQVNBLEVBQ1R0RCxFQUFHdUgsRUFDSC9ELFNBQVUzRSxLQUFLZ0gsY0FDZnBDLEtBQU0sU0FDTmlFLFdBQVk3SSxLQUFLa0ksT0FBU0ssRUFBTyxNQUNqQyxFQUdBTyxFQUFnQnJILE9BQU9jLEtBQUttQyxRQUFRLEVBQUcxRSxLQUFLZ0gsZUFDaERoSCxLQUFLK0ksY0FBZ0IvSSxLQUFLa0IsTUFBTWtILEtBQUtDLFlBQ25DUyxFQUNBUCxFQUNBLEdBQ0F2SSxLQUVKLEVBU0YsTUFBTWdKLFVBQWtCdEMsRUFDdEIsV0FBQXpGLENBQVlDLEdBQ1ZnRyxNQUFNaEcsRUFBTyxZQUFhLEtBQU0sS0FBSyxHQUNyQ2xCLEtBQUtpSixLQUFPLEdBQ1pqSixLQUFLNEksVUFBWSxJQUFJLEVBQ25CNUksS0FBS2tCLE1BQ0xsQixLQUFLbUIsRUFBSSxHQUNUbkIsS0FBS29CLEVBQUksR0FDVHBCLEtBQUtpSixLQUVULENBR0EsS0FBQXJCLENBQU16RyxFQUFHQyxHQUNQcEIsS0FBSzZILFlBQVkxRyxHQUFJLEtBQ3JCbkIsS0FBS2lILFVBQVcsRUFFaEJqSCxLQUFLa0IsTUFBTXNELE9BQU96QyxJQUFJLENBQ3BCMEMsUUFBU3pFLEtBQ1RvQixFQUFHQSxFQUNIdUQsU0FBVSxLQUNWQyxLQUFNLFNBQ05pRSxXQUFZLEtBQ1Y3SSxLQUFLc0gsY0FDTHRILEtBQUtxSCxnQkFDTHJILEtBQUtpSCxVQUFXLENBQUssSUFJekJqSCxLQUFLOEgsV0FBVSxHQUNmOUgsS0FBS3FELFlBQVcsRUFDbEIsQ0FFQSxPQUFBNkYsQ0FBUUMsR0FDTm5KLEtBQUs0SSxVQUFVM0csU0FBU2pDLEtBQUtpSixLQUFPRSxHQUNwQ25KLEtBQUtpSixLQUFPRSxDQUNkLENBRUEsYUFBQTlCLEdBQ0UsR0FBSVUsRUFBT0MsSUFBSSxtQkFBb0IsT0FFbkMsSUFBSUMsRUFBUSxLQUNWLElBQUtqSSxLQUFLa0ksT0FBUSxPQUVsQixJQUFJa0IsRUFBa0I1QyxFQUFhVCxPQUNqQy9GLEtBQUttQixFQUNMbkIsS0FBS29CLEVBQUlwQixLQUFLdUIsT0FBUyxFQUFJLEdBQzNCLG1CQUlFOEgsRUFBUTVILE9BQU9jLEtBQUsrRyxNQUFNNUUsUUFDNUIxRSxLQUFLbUIsRUFDTG5CLEtBQUtvQixFQUNMLEVBQU93QyxPQUFPekMsRUFDZCxFQUFPeUMsT0FBT3hDLEdBT1ptSSxFQUhRLElBR1loSCxLQUFLaUgsSUFBSUgsR0FDN0JJLEVBSlEsSUFJWWxILEtBQUttSCxJQUFJTCxHQUdqQ0QsRUFBZ0JPLFlBQVlKLEVBQVdFLEdBRW5DekosS0FBS2tJLFNBQ1BsSSxLQUFLbUksZUFBaUJuSSxLQUFLa0IsTUFBTWtILEtBQUtDLFlBQ3BDNUcsT0FBT2MsS0FBS21DLFFBQVEsSUFBSzFFLEtBQUsrRyxZQUM5QmtCLEVBQ0EsR0FDQWpJLE1BRUosRUFHRmlJLEdBQ0YsRUFJRixJQUFJMkIsRUFBZ0I1SixLQUFLNkQsUUFBUTlCLElBQUlhLE1BQU0sQ0FDekNpSCxVQTFGRixjQUEyQm5ELEVBQ3pCLFdBQUF6RixDQUFZQyxHQUNWZ0csTUFBTWhHLEVBQU8sUUFBUyxLQUFNLEtBQzlCLEtBMEZGLElBQUssSUFBSUwsRUFBSSxFQUFHQSxFQUFJc0YsRUFBYXlELGNBQWUvSSxJQUNsQytJLEVBQWM1QixNQUNwQkosTUFBTSxJQUFNLElBQU0vRyxFQUFHLEtBTzdCNkcsRUFBVzFILEtBQUs2RCxRQUFROUIsSUFBSWEsUUFLNUJrSCxFQUFpQjlKLEtBQUsrSixNQUFNaEksSUFBSSxrQkFDaENpSSxFQUFhaEssS0FBSytKLE1BQU1oSSxJQUFJLGNBQzVCa0ksRUFBa0JqSyxLQUFLK0osTUFBTWhJLElBQUkscUJBV0gsU0FBMUJnRyxFQUFPQyxJQUFJLGFBQ1JrQyxJQUNIQSxFQUFjbEssS0FBSytKLE1BQU1oSSxJQUFJLGVBQzdCbUksRUFBWUMsVUFBVSxJQUN0QkQsRUFBWWxGLFNBSW1CLFNBQS9CK0MsRUFBT0MsSUFBSSxpQkFDYjRCLEVBQWMzRyxjQUFjLEdBQUdzRSxZQUFZQyxLQVE3Q3hILEtBQUtvSyxNQUFNckUsT0FBTyxDQUNoQmxELElBQUssVUFDTHdILE9BQVFySyxLQUFLb0ssTUFBTUUscUJBQXFCLHFCQUFzQixDQUM1REMsTUFBTyxFQUNQQyxJQUFLLEVBQ0xDLE1BQU8sSUFFVEMsVUFBVyxHQUNYNUgsT0FBUSxFQUNSNkgsZ0JBQWdCLElBR2xCM0ssS0FBS29LLE1BQU1yRSxPQUFPLENBQ2hCbEQsSUFBSyxtQkFDTHdILE9BQVFySyxLQUFLb0ssTUFBTUUscUJBQXFCLHVCQUF3QixDQUM5REMsTUFBTyxFQUNQQyxJQUFLLEdBQ0xDLE1BQU8sSUFFVEMsVUFBVyxHQUNYNUgsT0FBUSxFQUNSNkgsZ0JBQWdCLElBUWxCM0ssS0FBSzZELFFBQVE5QixJQUFJNkksUUFDZm5FLEVBQ0FtRCxHQUNBLFNBQVVpQixFQUFjQyxHQUN0QkQsRUFBYTlGLFVBQ2IrRSxFQUFlOUUsT0FDWDhGLEVBQU0zQyxnQkFDUjJDLEVBQU0zQyxlQUFlNEMsU0FFdkJELEVBQU0vRixVQUdrQnRELE9BQU9jLEtBQUttQyxRQUFRLEVBQUcsS0FDdkIsSUFDdEJvRyxFQUFNdkQsWUFBWUMsS0FJcEIsSUFBSXdELEdBQWMsRUFNbEIsR0FMQXBCLEVBQWMzRyxjQUFjQyxTQUFTNEgsSUFDL0JBLEVBQU01QyxTQUNSOEMsR0FBYyxFQUNoQixLQUVrQixJQUFoQkEsR0FBeUIsRUFBT3BILE9BQU9zRSxPQUFRLENBQ2pELElBQUkrQyxFQUFpQmpMLEtBQUs2RCxRQUFROUIsSUFBSWEsTUFBTSxDQUFFaUgsVUFBV2IsSUFDekRrQyxFQUFZRCxFQUFlakQsTUFDM0JrRCxFQUFVdEQsTUFBTTNDLEVBQU8zRCxNQUFRLEVBQUcsS0FHbEN0QixLQUFLNkQsUUFBUTlCLElBQUk2SSxRQUNmTSxFQUNBekUsR0FDQSxTQUFVeUUsRUFBV0wsR0FLbkIsR0FGQUEsRUFBYTlGLFdBRVRtRyxFQUFVakUsV0FDZGlFLEVBQVVoQyxRQUFRZ0MsRUFBVWpDLEtBQU8sR0FFWixJQUFuQmlDLEVBQVVqQyxNQUFjLEVBQU9yRixPQUFPc0UsUUFBUSxDQUNoRGdELEVBQVVuRyxVQUNWbUcsRUFBVXRDLFVBQVVwSCxJQUFJdUQsVUFDeEIvRSxLQUFLNkQsUUFBUTlCLElBQ1Y2QixPQUFPc0gsRUFBVS9KLEVBQUcrSixFQUFVOUosRUFBRyxvQkFDakM0RCxLQUFLLG9CQUNSOEUsRUFBZTlFLE9BR2YsSUFBSW1HLEVBQU9uTCxLQUFLK0IsSUFDYm9KLEtBQUssRUFBRyxFQUFHLFdBQVksQ0FDdEJDLEtBQU0sd0RBQ05DLEtBQU0sU0FFUG5GLFVBQVUsR0FBSyxJQUNmMkIsWUFBWTVDLEVBQU8zRCxNQUFRLEVBQUcyRCxFQUFPMUQsT0FBUyxHQUM5QzhCLFlBQVcsR0FFZHJELEtBQUtvSSxLQUFLQyxZQUNSLEtBQ0EsV0FDRThDLEVBQUs5SCxZQUFXLEVBQ2xCLEdBQ0EsR0FDQXJELEtBRUosQ0FDRixHQUNBLEtBQ0FBLEtBRUosQ0FDRixHQUNBLEtBQ0FBLE1BSUZBLEtBQUs2RCxRQUFROUIsSUFBSTZJLFFBQ2YsRUFBT2hILE9BQ1A0QyxHQUNBLFNBQVU4RSxFQUFjQyxHQUt0QixHQUpBRCxFQUFhdkgsT0FBT08sYUFBYSxHQUNqQ2lILEVBQVl4RyxVQUNaa0YsRUFBZ0JqRixPQUVaLEVBQU9yQixPQUFTLEVBQUcsT0FFdkI0SCxFQUFZeEcsVUFDWixFQUFPQSxVQUVQLElBQUl5RyxFQUFjeEwsS0FBSytCLElBQ3BCb0osS0FBSyxFQUFHLEVBQUcsV0FBWSxDQUN0QkMsS0FBTSx3REFDTkMsS0FBTSxTQUVQbkYsVUFBVSxHQUFLLElBQ2YyQixZQUFZNUMsRUFBTzNELE1BQVEsRUFBRzJELEVBQU8xRCxPQUFTLEdBQzlDOEIsWUFBVyxHQUVWb0ksRUFBcUJ6TCxLQUFLK0IsSUFDM0JvSixLQUFLLEVBQUcsRUFBRyx5QkFBMEIsQ0FDcENDLEtBQU0sd0RBQ05DLEtBQU0sU0FFUG5GLFVBQVUsR0FBSyxJQUNmMkIsWUFBWTVDLEVBQU8zRCxNQUFRLEVBQUcyRCxFQUFPMUQsT0FBUyxFQUFJLEtBQ2xEOEIsWUFBVyxHQUVkckQsS0FBS29JLEtBQUtDLFlBQ1IsS0FDQSxXQUNFbUQsRUFBWW5JLFlBQVcsRUFDekIsR0FDQSxHQUNBckQsTUFFRkEsS0FBS29JLEtBQUtDLFlBQ1IsTUFDQSxXQUNFb0QsRUFBbUJwSSxZQUFXLEdBQzlCcUksR0FBZSxDQUNqQixHQUNBLEdBQ0ExTCxLQUVKLEdBQ0EsS0FDQUEsTUFJRkEsS0FBSzZELFFBQVE5QixJQUFJNkksUUFDZixFQUFPaEgsT0FDUDhELEdBQ0EsU0FBVTRELEVBQWM3RCxHQUN0QkEsRUFBUUwsT0FBT2tFLEVBQWF2SCxRQUM1QjBELEVBQVExQyxVQUVSL0UsS0FBS29JLEtBQUtDLFlBQ1IsTUFDQSxXQUNFWixFQUFRRSxPQUFPMkQsRUFBYXZILE9BQzlCLEdBQ0EsR0FDQS9ELEtBRUosR0FDQSxLQUNBQSxLQUVKLEVBemZJMkwsT0EyZkosV0FFTSxFQUFPL0gsT0FBT3NFLFNBQ1o5QixFQUFRd0YsS0FBS0MsT0FDZixFQUFPMUgsY0FBYyxFQUFPVixPQUNuQjJDLEVBQVEwRixNQUFNRCxPQUN2QixFQUFPMUgsYUFBYSxFQUFPVixPQUNsQjJDLEVBQVEyRixLQUFLRixPQUN0QixFQUFPeEgsYUFBYSxFQUFPWixPQUNsQjJDLEVBQVE0RixHQUFHSCxPQUNwQixFQUFPeEgsY0FBYyxFQUFPWixRQUU1QixFQUFPVSxhQUFhLEdBQ3BCLEVBQU9FLGFBQWEsS0FLcEI1QyxPQUFPd0ssTUFBTUMsU0FBU0MsU0FBUy9GLEVBQVFnRyxTQUNyQyxFQUFPeEksT0FBT3NFLE9BQ00sWUFBbEIsRUFBT3hFLFFBQ1UrQyxFQUFjVixPQUMvQixFQUFPbkMsT0FBT3pDLEVBQ2QsRUFBT3lDLE9BQU94QyxFQUFJLEVBQU93QyxPQUFPckMsT0FBUyxHQUN6QyxnQkFFVzhDLGNBQWMsRUFBT1osT0FDbEN1RyxFQUFXaEYsUUFDZ0IsbUJBQWxCLEVBQU90QixTQUNJK0MsRUFBY1YsT0FDaEMsRUFBT25DLE9BQU96QyxFQUFJLEdBQ2xCLEVBQU95QyxPQUFPeEMsRUFBSSxFQUFPd0MsT0FBT3JDLE9BQVMsR0FDekMsZ0JBRVk4QyxjQUFjLEVBQU9aLE9BQ2ZnRCxFQUFjVixPQUNoQyxFQUFPbkMsT0FBT3pDLEVBQUksR0FDbEIsRUFBT3lDLE9BQU94QyxFQUFJLEVBQU93QyxPQUFPckMsT0FBUyxHQUN6QyxnQkFFWThDLGNBQWMsRUFBT1osT0FDbkN1RyxFQUFXaEYsUUFHVDBHLElBRUZBLEdBQWUsRUFDZjFMLEtBQUtrQixNQUFNbUwsWUFNakJyRyxFQUFHc0csZUFBaUIsR0FDdEIsSUE3aUJBLElBVUksRUFDQWxHLEVBQ0FJLEVBQ0FDLEVBQ0FpQixFQUNBMUIsRUFDQThELEVBQ0FFLEVBQ0FDLEVBQ0FDLEVBQ0FnQixFQXBCQW5ELEVBQVMsSUFBSXdFLGdCQUFnQnBNLE9BQU9HLFNBQVNrTSxRQUU3Q3JHLEVBQWUsQ0FDakI3QyxZQUFhLElBQ2JDLGFBQWMsVUFDZEMsYUFBYyxFQUNkb0csY0FBZTdCLEVBQU9DLElBQUksaUJBQW1CRCxFQUFPQyxJQUFJLGlCQUFtQixJQWV6RTBELEdBWk8sSUFBSWpLLE9BQU9nTCxLQUFLeEgsSUFZUixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3BhY2VtYXN0ZXIvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc3BhY2VtYXN0ZXIvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly9zcGFjZW1hc3Rlci93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly9zcGFjZW1hc3Rlci8uL3NyYy9qcy9jbGFzc2VzL2hlYWx0aGJhci5qcyIsIndlYnBhY2s6Ly9zcGFjZW1hc3Rlci8uL3NyYy9qcy9jbGFzc2VzL2hlYXJ0cy5qcyIsIndlYnBhY2s6Ly9zcGFjZW1hc3Rlci8uL3NyYy9qcy9jbGFzc2VzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9zcGFjZW1hc3Rlci8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGUgcmVxdWlyZSBzY29wZVxudmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTtcblxuIiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICFzY3JpcHRVcmwpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybDsiLCJjbGFzcyBIZWFsdGhCYXIge1xuICBjb25zdHJ1Y3RvcihzY2VuZSwgeCwgeSwgbWF4TGlmZSwgd2lkdGgsIGhlaWdodCkge1xuICAgIHRoaXMuYmFyID0gbmV3IFBoYXNlci5HYW1lT2JqZWN0cy5HcmFwaGljcyhzY2VuZSk7XG5cbiAgICB0aGlzLnggPSB4O1xuICAgIHRoaXMueSA9IHk7XG4gICAgdGhpcy5tYXhMaWZlID0gbWF4TGlmZTtcbiAgICB0aGlzLmN1cnJlbnRIZWFsdGggPSBtYXhMaWZlO1xuICAgIHRoaXMucGVyY2VudCA9IDE7XG5cbiAgICB0aGlzLndpZHRoID0gd2lkdGggfHwgODA7XG4gICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQgfHwgMTQ7XG5cbiAgICB0aGlzLmRyYXcoKTtcblxuICAgIHNjZW5lLmFkZC5leGlzdGluZyh0aGlzLmJhcik7XG4gIH1cblxuICBkZWNyZWFzZShhbW91bnQpIHtcbiAgICB0aGlzLmN1cnJlbnRIZWFsdGggLT0gYW1vdW50O1xuXG4gICAgaWYgKHRoaXMuY3VycmVudEhlYWx0aCA8IDApIHtcbiAgICAgIHRoaXMuY3VycmVudEhlYWx0aCA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5wZXJjZW50ID0gdGhpcy5jdXJyZW50SGVhbHRoIC8gdGhpcy5tYXhMaWZlO1xuICAgIHRoaXMuZHJhdygpO1xuICB9XG5cbiAgZHJhdygpIHtcbiAgICB0aGlzLmJhci5jbGVhcigpO1xuXG4gICAgLy8gV2hpdGUgQkdcbiAgICB0aGlzLmJhci5maWxsU3R5bGUoMHhmZmZmZmYpO1xuICAgIHRoaXMuYmFyLmZpbGxSZWN0KHRoaXMueCArIDIsIHRoaXMueSArIDIsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgIGlmICh0aGlzLnBlcmNlbnQgPCAwLjMpIHtcbiAgICAgIHRoaXMuYmFyLmZpbGxTdHlsZSgweGZmMDAwMCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYmFyLmZpbGxTdHlsZSgweDAwZmYwMCk7XG4gICAgfVxuXG4gICAgLy8gQWN0dWFsIGhlYWx0aCBiYXJcbiAgICB2YXIgZCA9IE1hdGguZmxvb3IodGhpcy5wZXJjZW50ICogdGhpcy53aWR0aCk7XG5cbiAgICB0aGlzLmJhci5maWxsUmVjdCh0aGlzLnggKyAyLCB0aGlzLnkgKyAyLCBkLCB0aGlzLmhlaWdodCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSGVhbHRoQmFyO1xuIiwiY2xhc3MgSGVhcnRzIHtcbiAgY29uc3RydWN0b3Ioc2NlbmUsIHgsIHksIG1heExpdmVzKSB7XG4gICAgdGhpcy54ID0geDtcbiAgICB0aGlzLnkgPSB5O1xuICAgIHRoaXMubWF4TGl2ZXMgPSBtYXhMaXZlcztcbiAgICB0aGlzLmN1cnJlbnRMaXZlcyA9IG1heExpdmVzO1xuXG4gICAgdGhpcy5oZWFydHMgPSBzY2VuZS5hZGQuZ3JvdXAoe1xuICAgICAga2V5OiBcImhlYXJ0XCIsXG4gICAgICByZXBlYXQ6IHRoaXMubWF4TGl2ZXMgLSAxLFxuICAgICAgc2V0WFk6IHsgeDogdGhpcy54LCB5OiB0aGlzLnksIHN0ZXBYOiAzMiB9LFxuICAgIH0pO1xuICB9XG5cbiAgZGVjcmVhc2UoYW1vdW50KSB7XG4gICAgdGhpcy5jdXJyZW50TGl2ZXMgLT0gYW1vdW50O1xuXG4gICAgLy8gQ2FuJ3QgZ28gYmVsb3cgMFxuICAgIGlmICh0aGlzLmN1cnJlbnRMaXZlcyA8IDApIHtcbiAgICAgIHRoaXMuY3VycmVudExpdmVzID0gMDtcbiAgICB9XG5cbiAgICAvLyBSZWRyYXcgaGVhcnRzXG4gICAgdGhpcy5oZWFydHMuZ2V0Q2hpbGRyZW4oKS5mb3JFYWNoKChoZWFydCwgaW5kZXgpID0+IHtcbiAgICAgIGhlYXJ0LnNldFZpc2libGUoaW5kZXggPCB0aGlzLmN1cnJlbnRMaXZlcyk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSGVhcnRzO1xuIiwiaW1wb3J0IEhlYXJ0cyBmcm9tIFwiLi9oZWFydHMuanNcIjtcblxuY2xhc3MgUGxheWVyIHtcbiAgY29uc3RydWN0b3Ioc2NlbmUsIHgsIHksIHBsYXllclNwZWVkLCBwbGF5ZXJXZWFwb24sIHBsYXllckhlYWx0aCkge1xuICAgIHRoaXMuc3BlZWQgPSBwbGF5ZXJTcGVlZDtcbiAgICB0aGlzLndlYXBvbiA9IHBsYXllcldlYXBvbjtcbiAgICB0aGlzLmhlYWx0aCA9IHBsYXllckhlYWx0aDtcblxuICAgIHRoaXMuc3ByaXRlID0gc2NlbmUucGh5c2ljcy5hZGQuc3ByaXRlKHgsIHksIFwicGxheWVyXCIpO1xuICAgIHRoaXMuc3ByaXRlLnNldENvbGxpZGVXb3JsZEJvdW5kcyh0cnVlKTsgLy8ga2VlcHMgdGhlIHBsYXllciB3aXRoaW4gdGhlIGdhbWUgd29ybGRcbiAgICB0aGlzLnNwcml0ZS5wbGF5ZXIgPSB0aGlzO1xuXG4gICAgdGhpcy5oZWFydHMgPSBuZXcgSGVhcnRzKHNjZW5lLCAzMCwgODMwLCB0aGlzLmhlYWx0aCk7XG5cbiAgICB0aGlzLmV4cGxvc2lvbiA9IHNjZW5lLnBoeXNpY3MuYWRkLnNwcml0ZShcbiAgICAgIHRoaXMuc3ByaXRlLngsXG4gICAgICB0aGlzLnNwcml0ZS55LFxuICAgICAgXCJleHBsb3Npb25cIlxuICAgICk7XG4gIH1cblxuICBzZXRTcGVlZCA9IChzcGVlZCkgPT4ge1xuICAgIHRoaXMuc3BlZWQgPSBzcGVlZDtcbiAgfTtcblxuICBzZXRXZWFwb25zID0gKHdlYXBvbikgPT4ge1xuICAgIHRoaXMud2VhcG9uID0gd2VhcG9uO1xuICB9O1xuXG4gIHNldFZlbG9jaXR5WCA9ICh2ZWxvY2l0eSkgPT4ge1xuICAgIHRoaXMuc3ByaXRlLnNldFZlbG9jaXR5WCh2ZWxvY2l0eSk7XG4gIH07XG5cbiAgc2V0VmVsb2NpdHlZID0gKHZlbG9jaXR5KSA9PiB7XG4gICAgdGhpcy5zcHJpdGUuc2V0VmVsb2NpdHlZKHZlbG9jaXR5KTtcbiAgfTtcblxuICBkZWNyZWFzZUxpZmUoYW1vdW50KSB7XG4gICAgYWxlcnQoXCJvb3BzXCIpO1xuICAgIC8vdGhpcy5oZWFsdGggLT0gYW1vdW50O1xuICAgIC8vdGhpcy5oZWFydHMuZGVjcmVhc2UoYW1vdW50KTtcblxuICAgIHRoaXMuc3ByaXRlLnNjZW5lLnR3ZWVucy5hZGQoe1xuICAgICAgdGFyZ2V0czogdGhpcy5zcHJpdGUsXG4gICAgICB4OiB0aGlzLnNwcml0ZS54ICsgUGhhc2VyLk1hdGguQmV0d2VlbigtMTAsIDEwKSxcbiAgICAgIHk6IHRoaXMuc3ByaXRlLnkgKyBQaGFzZXIuTWF0aC5CZXR3ZWVuKC0xMCwgMTApLFxuICAgICAgZHVyYXRpb246IDEwMCxcbiAgICAgIHJlcGVhdDogNSxcbiAgICAgIGVhc2U6IFwiTGluZWFyXCIsXG4gICAgICBhbHBoYTogMCxcbiAgICAgIHlveW86IHRydWUsXG4gICAgfSk7XG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIHRoaXMuZXhwbG9zaW9uLnBsYXkoXCJleHBsb2RlXCIpO1xuICAgIHRoaXMuc3ByaXRlLmRlc3Ryb3koKTtcbiAgfVxufVxuZXhwb3J0IGRlZmF1bHQgUGxheWVyO1xuIiwiLy8gQ2xhc3Nlc1xuaW1wb3J0IEhlYWx0aEJhciBmcm9tIFwiLi9qcy9jbGFzc2VzL2hlYWx0aGJhci5qc1wiO1xuaW1wb3J0IFBsYXllciBmcm9tIFwiLi9qcy9jbGFzc2VzL3BsYXllci5qc1wiO1xuXG4vLyBJbWFnZXNcbmltcG9ydCBwbGF5ZXJJbWcgZnJvbSBcIi4vYXNzZXRzL3BsYXllci5wbmdcIjtcbmltcG9ydCBoZWFydEltZyBmcm9tIFwiLi9hc3NldHMvaGVhcnQucG5nXCI7XG5pbXBvcnQgYnVsbGV0SW1nIGZyb20gXCIuL2Fzc2V0cy9idWxsZXQucG5nXCI7XG5pbXBvcnQgcGxheWVyQnVsbGV0SW1nIGZyb20gXCIuL2Fzc2V0cy9wbGF5ZXItYnVsbGV0LnBuZ1wiO1xuaW1wb3J0IGJvc3NBbGllbkJ1bGxldEltZyBmcm9tIFwiLi9hc3NldHMvYm9zcy1hbGllbi1idWxsZXQucG5nXCI7XG5pbXBvcnQgYWxpZW5JbWcgZnJvbSBcIi4vYXNzZXRzL2FsaWVuLnBuZ1wiO1xuaW1wb3J0IGJvc3NBbGllbkltZyBmcm9tIFwiLi9hc3NldHMvYm9zcy1hbGllbi5wbmdcIjtcbmltcG9ydCBzcGFjZUJnIGZyb20gXCIuL2Fzc2V0cy9zcGFjZS5wbmdcIjtcblxuLy8gU291bmRzXG5pbXBvcnQgZXhwbG9zaW9uU291bmRGaWxlIGZyb20gXCIuL2Fzc2V0cy9zb3VuZHMvZXhwbG9zaW9uLndhdlwiO1xuaW1wb3J0IHNob290U291bmRGaWxlIGZyb20gXCIuL2Fzc2V0cy9zb3VuZHMvc2hvb3Qud2F2XCI7XG5pbXBvcnQgaW1wYWN0U2NyZWFtRmlsZSBmcm9tIFwiLi9hc3NldHMvc291bmRzL2ltcGFjdC1zY3JlYW0ud2F2XCI7XG5cbi8vIE11c2ljXG5pbXBvcnQgbXVzaWMxRmlsZSBmcm9tIFwiLi9hc3NldHMvbXVzaWMvMTcyX2RydW1fbl9iYXNzX3JlZ2FsX2hlYXZ5X2VsZWN0cm9uaWNfZHJ1bXMud2F2XCI7XG5cbi8vIFNwcml0ZXNcbmltcG9ydCBwbGF5ZXIxRXhwbG9zaW9uU3ByaXRlIGZyb20gXCIuL2Fzc2V0cy9wbGF5ZXItMS1leHBsb3Npb24tc3ByaXRlLnBuZ1wiO1xuaW1wb3J0IGJvc3NBbGllbkV4cGxvc2lvblNwcml0ZSBmcm9tIFwiLi9hc3NldHMvYm9zcy1hbGllbi1leHBsb3Npb24tc3ByaXRlLnBuZ1wiO1xuXG4vLyBVcGdyYWRlc1xuaW1wb3J0IHgyVXBncmFkZUltZyBmcm9tIFwiLi9hc3NldHMvdXBncmFkZXMveDIucG5nXCI7XG5cbmNvbnN0IGNvbmZpZyA9IHtcbiAgdHlwZTogUGhhc2VyLkFVVE8sXG4gIHdpZHRoOiAxNTAwLFxuICBoZWlnaHQ6IDkwMCxcbiAgcGh5c2ljczoge1xuICAgIGRlZmF1bHQ6IFwiYXJjYWRlXCIsXG4gICAgYXJjYWRlOiB7XG4gICAgICBncmF2aXR5OiB7IHk6IDAgfSxcbiAgICB9LFxuICB9LFxuICBzY2VuZToge1xuICAgIHByZWxvYWQ6IHByZWxvYWQsXG4gICAgY3JlYXRlOiBjcmVhdGUsXG4gICAgdXBkYXRlOiB1cGRhdGUsXG4gIH0sXG59O1xuXG5sZXQgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcblxubGV0IGdhbWVTZXR0aW5ncyA9IHtcbiAgcGxheWVyU3BlZWQ6IDMzMCxcbiAgcGxheWVyV2VhcG9uOiBcImJ1bGxldHNcIixcbiAgcGxheWVySGVhbHRoOiAzLFxuICByZWd1bGFyQWxpZW5zOiBwYXJhbXMuZ2V0KFwicmVndWxhckFsaWVuc1wiKSA/IHBhcmFtcy5nZXQoXCJyZWd1bGFyQWxpZW5zXCIpIDogMTEsXG59O1xuXG5sZXQgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZShjb25maWcpO1xubGV0IHBsYXllcjtcbmxldCBjdXJzb3JzO1xubGV0IGFsaWVuQnVsbGV0cztcbmxldCBwbGF5ZXJCdWxsZXRzO1xubGV0IHVwZ3JhZGVzO1xubGV0IGJnO1xubGV0IGV4cGxvc2lvblNvdW5kO1xubGV0IHNob290U291bmQ7XG5sZXQgcGxheWVyRGVhZFNvdW5kO1xubGV0IGxldmVsMU11c2ljO1xubGV0IGJvc3NBbGllbjtcbmxldCBhbGxvd1Jlc3RhcnQgPSBmYWxzZTtcblxuZnVuY3Rpb24gcHJlbG9hZCgpIHtcbiAgdGhpcy5sb2FkLmltYWdlKFwicGxheWVyXCIsIHBsYXllckltZyk7XG4gIHRoaXMubG9hZC5pbWFnZShcImhlYXJ0XCIsIGhlYXJ0SW1nKTtcbiAgdGhpcy5sb2FkLmltYWdlKFwiYnVsbGV0XCIsIGJ1bGxldEltZyk7XG4gIHRoaXMubG9hZC5pbWFnZShcInBsYXllckJ1bGxldFwiLCBwbGF5ZXJCdWxsZXRJbWcpO1xuICB0aGlzLmxvYWQuaW1hZ2UoXCJhbGllblwiLCBhbGllbkltZyk7XG4gIHRoaXMubG9hZC5pbWFnZShcImJvc3NBbGllblwiLCBib3NzQWxpZW5JbWcpO1xuICB0aGlzLmxvYWQuaW1hZ2UoXCJib3NzQWxpZW5CdWxsZXRcIiwgYm9zc0FsaWVuQnVsbGV0SW1nKTtcbiAgdGhpcy5sb2FkLmltYWdlKFwic3BhY2VcIiwgc3BhY2VCZyk7XG4gIHRoaXMubG9hZC5pbWFnZShcIngyVXBncmFkZVwiLCB4MlVwZ3JhZGVJbWcpO1xuICB0aGlzLmxvYWQuYXVkaW8oXCJleHBsb3Npb25Tb3VuZFwiLCBleHBsb3Npb25Tb3VuZEZpbGUpO1xuICB0aGlzLmxvYWQuYXVkaW8oXCJzaG9vdFNvdW5kXCIsIHNob290U291bmRGaWxlKTtcbiAgdGhpcy5sb2FkLmF1ZGlvKFwiaW1wYWN0U2NyZWFtU291bmRcIiwgaW1wYWN0U2NyZWFtRmlsZSk7XG4gIHRoaXMubG9hZC5hdWRpbyhcImxldmVsMU11c2ljXCIsIG11c2ljMUZpbGUpO1xuICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoXCJwbGF5ZXItMS1leHBsb3Npb25cIiwgcGxheWVyMUV4cGxvc2lvblNwcml0ZSwge1xuICAgIGZyYW1lV2lkdGg6IDIzMCxcbiAgICBmcmFtZUhlaWdodDogMTI1LFxuICAgIGVuZEZyYW1lOiA5LFxuICB9KTtcbiAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KFwiYm9zcy1hbGllbi1leHBsb3Npb25cIiwgYm9zc0FsaWVuRXhwbG9zaW9uU3ByaXRlLCB7XG4gICAgZnJhbWVXaWR0aDogNjAwLFxuICAgIGZyYW1lSGVpZ2h0OiA0MjAsXG4gICAgZW5kRnJhbWU6IDEwLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlKCkge1xuICAvKlxuICAgKiBTQ0VORVxuICAgKi9cbiAgYmcgPSB0aGlzLmFkZC50aWxlU3ByaXRlKDAsIDAsIDE1MDAsIDkwMCwgXCJzcGFjZVwiKTtcbiAgYmcuc2V0T3JpZ2luKDAsIDApO1xuXG4gIHBsYXllciA9IG5ldyBQbGF5ZXIoXG4gICAgdGhpcyxcbiAgICBjb25maWcud2lkdGggLyAyLFxuICAgIGNvbmZpZy5oZWlnaHQgLSAxNTAsXG4gICAgZ2FtZVNldHRpbmdzLnBsYXllclNwZWVkLFxuICAgIGdhbWVTZXR0aW5ncy5wbGF5ZXJXZWFwb24sXG4gICAgZ2FtZVNldHRpbmdzLnBsYXllckhlYWx0aFxuICApO1xuXG4gIC8qXG4gICAqIE1JU0MgU1BSSVRFU1xuICAgKi9cbiAgY3Vyc29ycyA9IHRoaXMuaW5wdXQua2V5Ym9hcmQuY3JlYXRlQ3Vyc29yS2V5cygpO1xuICBhbGllbkJ1bGxldHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7XG4gIHBsYXllckJ1bGxldHMgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKCk7XG5cbiAgLypcbiAgICogQUxJRU5TXG4gICAqL1xuICBjbGFzcyBBbGllbiBleHRlbmRzIFBoYXNlci5QaHlzaWNzLkFyY2FkZS5TcHJpdGUge1xuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCB0ZXh0dXJlLCBzaG9vdERlbGF5LCBtb3ZlbWVudFNwZWVkLCBzcGF3bmluZykge1xuICAgICAgc3VwZXIoc2NlbmUsIDAsIDAsIHRleHR1cmUpO1xuICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xuICAgICAgdGhpcy5zaG9vdERlbGF5ID0gc2hvb3REZWxheTtcbiAgICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IG1vdmVtZW50U3BlZWQ7XG4gICAgICB0aGlzLnNwYXduaW5nID0gc3Bhd25pbmc7XG4gICAgICAvLyBBZGQgdGhpcyB0byB0aGUgcGh5c2ljcyBzeXN0ZW1cbiAgICAgIHRoaXMuc2NlbmUucGh5c2ljcy53b3JsZC5lbmFibGUodGhpcyk7XG4gICAgICAvLyBJbml0aWFsaXplIHNob290aW5nIGFuZCBtb3ZpbmdcbiAgICAgIGlmICghdGhpcy5zcGF3bmluZykge1xuICAgICAgICB0aGlzLnN0YXJ0U2hvb3RpbmcoKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5zcGF3bmluZykgdGhpcy5zdGFydE1vdmluZygpO1xuXG4gICAgICB0aGlzLmRyb3BVcGdyYWRlID0ge1xuICAgICAgICB4MjogKCkgPT4ge1xuICAgICAgICAgIGxldCB1cGdyYWRlID0gdXBncmFkZXMuY3JlYXRlKHRoaXMueCwgdGhpcy55LCBcIngyVXBncmFkZVwiKTtcbiAgICAgICAgICB1cGdyYWRlLmVuYWJsZSA9IChwbGF5ZXIpID0+IHtcbiAgICAgICAgICAgIHBsYXllci5zZXRTcGVlZChnYW1lU2V0dGluZ3MucGxheWVyU3BlZWQgKiAxLjUpO1xuICAgICAgICAgICAgcGxheWVyLnNldFdlYXBvbnMoXCJkb3VibGUtYnVsbGV0c1wiKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHVwZ3JhZGUuZXhwaXJlID0gKHBsYXllcikgPT4ge1xuICAgICAgICAgICAgcGxheWVyLnNldFNwZWVkKGdhbWVTZXR0aW5ncy5wbGF5ZXJTcGVlZCk7XG4gICAgICAgICAgICBwbGF5ZXIuc2V0V2VhcG9ucyhcImJ1bGxldHNcIik7XG4gICAgICAgICAgfTtcbiAgICAgICAgICB1cGdyYWRlLnNldFZlbG9jaXR5WSgyMDApO1xuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBzZXR1cCh4LCB5KSB7XG4gICAgICB0aGlzLnNldFBvc2l0aW9uKHgsIHkpO1xuICAgICAgdGhpcy5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgICB0aGlzLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAvL3RoaXMuc2V0Q29sbGlkZVdvcmxkQm91bmRzKHRydWUpOyBUT09EOiBpbXBsZW1lbnRcbiAgICB9XG5cbiAgICBzdGFydFNob290aW5nKCkge1xuICAgICAgaWYgKHBhcmFtcy5nZXQoXCJub0FsaWVuU2hvb3RpbmdcIikpIHJldHVybjtcbiAgICAgIGxldCBzaG9vdCA9ICgpID0+IHtcbiAgICAgICAgbGV0IGJ1bGxldCA9IGFsaWVuQnVsbGV0cy5jcmVhdGUoXG4gICAgICAgICAgdGhpcy54LFxuICAgICAgICAgIHRoaXMueSArIHRoaXMuaGVpZ2h0IC8gMixcbiAgICAgICAgICBcImJ1bGxldFwiXG4gICAgICAgICk7XG4gICAgICAgIGJ1bGxldC5zZXRWZWxvY2l0eVkoMzAwKTtcblxuICAgICAgICBpZiAodGhpcy5hY3RpdmUpIHtcbiAgICAgICAgICB0aGlzLm5leHRTaG9vdEV2ZW50ID0gdGhpcy5zY2VuZS50aW1lLmRlbGF5ZWRDYWxsKFxuICAgICAgICAgICAgUGhhc2VyLk1hdGguQmV0d2VlbigzNTAsIHRoaXMuc2hvb3REZWxheSksXG4gICAgICAgICAgICBzaG9vdCxcbiAgICAgICAgICAgIFtdLFxuICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIEFkZCBhbiBpbml0aWFsIGRlbGF5IGJlZm9yZSB0aGUgZmlyc3Qgc2hvdFxuICAgICAgbGV0IGluaXRpYWxEZWxheSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgdGhpcy5zaG9vdERlbGF5KTtcbiAgICAgIHRoaXMubmV4dFNob290RXZlbnQgPSB0aGlzLnNjZW5lLnRpbWUuZGVsYXllZENhbGwoXG4gICAgICAgIGluaXRpYWxEZWxheSxcbiAgICAgICAgc2hvb3QsXG4gICAgICAgIFtdLFxuICAgICAgICB0aGlzXG4gICAgICApO1xuICAgIH1cblxuICAgIHN0YXJ0TW92aW5nKCkge1xuICAgICAgbGV0IG1vdmUgPSAoKSA9PiB7XG4gICAgICAgIGlmICghdGhpcy5hY3RpdmUpIHJldHVybjtcblxuICAgICAgICBsZXQgZGlyZWN0aW9uID0gUGhhc2VyLk1hdGguQmV0d2VlbigtMSwgMSk7XG4gICAgICAgIGxldCBkaXN0YW5jZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgMTAwKTtcblxuICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIHRhcmdldCB4IHBvc2l0aW9uXG4gICAgICAgIGxldCB0YXJnZXQgPSB0aGlzLnggKyBkaXJlY3Rpb24gKiBkaXN0YW5jZTtcbiAgICAgICAgaWYgKHRhcmdldCA+IHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggLSB0aGlzLndpZHRoIHx8IHRhcmdldCA8IDApIHtcbiAgICAgICAgICB0YXJnZXQgPSB0aGlzLng7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdGFyZ2V0cztcbiAgICAgICAgaWYgKHRoaXMuaGVhbHRoQmFyKSB7XG4gICAgICAgICAgdGFyZ2V0cyA9IFt0aGlzLCB0aGlzLmhlYWx0aEJhci5iYXJdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcmdldHMgPSBbdGhpc107XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgYSB0d2VlbiB0aGF0IGNoYW5nZXMgdGhlIHggcG9zaXRpb24gb2YgdGhlIGFsaWVuXG4gICAgICAgIHRoaXMuc2NlbmUudHdlZW5zLmFkZCh7XG4gICAgICAgICAgdGFyZ2V0czogdGFyZ2V0cyxcbiAgICAgICAgICB4OiB0YXJnZXQsXG4gICAgICAgICAgZHVyYXRpb246IHRoaXMubW92ZW1lbnRTcGVlZCwgLy8gcmFuZG9tIGR1cmF0aW9uIGJldHdlZW4gNTAwbXMgYW5kIDE1MDBtc1xuICAgICAgICAgIGVhc2U6IFwiTGluZWFyXCIsIC8vIHVzZSBsaW5lYXIgZWFzaW5nXG4gICAgICAgICAgb25Db21wbGV0ZTogdGhpcy5hY3RpdmUgPyBtb3ZlIDogbnVsbCwgLy8gY2FsbCB0aGlzIGZ1bmN0aW9uIGFnYWluIG9uY2UgdGhlIHR3ZWVuIGNvbXBsZXRlc1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIGxldCBtb3ZlbWVudERlbGF5ID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLm1vdmVtZW50U3BlZWQpO1xuICAgICAgdGhpcy5uZXh0TW92ZUV2ZW50ID0gdGhpcy5zY2VuZS50aW1lLmRlbGF5ZWRDYWxsKFxuICAgICAgICBtb3ZlbWVudERlbGF5LFxuICAgICAgICBtb3ZlLFxuICAgICAgICBbXSxcbiAgICAgICAgdGhpc1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBjbGFzcyBSZWd1bGFyQWxpZW4gZXh0ZW5kcyBBbGllbiB7XG4gICAgY29uc3RydWN0b3Ioc2NlbmUpIHtcbiAgICAgIHN1cGVyKHNjZW5lLCBcImFsaWVuXCIsIDQzMDAsIDEyMDApO1xuICAgIH1cbiAgfVxuXG4gIGNsYXNzIEJvc3NBbGllbiBleHRlbmRzIEFsaWVuIHtcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSkge1xuICAgICAgc3VwZXIoc2NlbmUsIFwiYm9zc0FsaWVuXCIsIDE4MDAsIDQwMCwgdHJ1ZSk7XG4gICAgICB0aGlzLmxpZmUgPSAyMDtcbiAgICAgIHRoaXMuaGVhbHRoQmFyID0gbmV3IEhlYWx0aEJhcihcbiAgICAgICAgdGhpcy5zY2VuZSxcbiAgICAgICAgdGhpcy54IC0gNDEsXG4gICAgICAgIHRoaXMueSArIDQwLFxuICAgICAgICB0aGlzLmxpZmVcbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gU2V0IHRoZSBzdGFydGluZyBwb3NpdGlvbiBvZiB0aGUgYm9zcyBhbGllblxuICAgIHNldHVwKHgsIHkpIHtcbiAgICAgIHRoaXMuc2V0UG9zaXRpb24oeCwgLTEwMCk7XG4gICAgICB0aGlzLnNwYXduaW5nID0gdHJ1ZTtcbiAgICAgIC8vIG1vdmUgdGhlIGJvc3NhbGllbiBpbnRvIHBvc2l0aW9uXG4gICAgICB0aGlzLnNjZW5lLnR3ZWVucy5hZGQoe1xuICAgICAgICB0YXJnZXRzOiB0aGlzLFxuICAgICAgICB5OiB5LFxuICAgICAgICBkdXJhdGlvbjogMTMwMCxcbiAgICAgICAgZWFzZTogXCJMaW5lYXJcIiwgLy8gdXNlIGxpbmVhciBlYXNpbmdcbiAgICAgICAgb25Db21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc3RhcnRNb3ZpbmcoKTtcbiAgICAgICAgICB0aGlzLnN0YXJ0U2hvb3RpbmcoKTtcbiAgICAgICAgICB0aGlzLnNwYXduaW5nID0gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5zZXRBY3RpdmUodHJ1ZSk7XG4gICAgICB0aGlzLnNldFZpc2libGUodHJ1ZSk7XG4gICAgfVxuXG4gICAgc2V0TGlmZSh2YWx1ZSkge1xuICAgICAgdGhpcy5oZWFsdGhCYXIuZGVjcmVhc2UodGhpcy5saWZlIC0gdmFsdWUpO1xuICAgICAgdGhpcy5saWZlID0gdmFsdWU7XG4gICAgfVxuXG4gICAgc3RhcnRTaG9vdGluZygpIHtcbiAgICAgIGlmIChwYXJhbXMuZ2V0KFwibm9BbGllblNob290aW5nXCIpKSByZXR1cm47XG5cbiAgICAgIGxldCBzaG9vdCA9ICgpID0+IHtcbiAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZSkgcmV0dXJuO1xuXG4gICAgICAgIGxldCBib3NzQWxpZW5CdWxsZXQgPSBhbGllbkJ1bGxldHMuY3JlYXRlKFxuICAgICAgICAgIHRoaXMueCxcbiAgICAgICAgICB0aGlzLnkgKyB0aGlzLmhlaWdodCAvIDIgLSA3MCxcbiAgICAgICAgICBcImJvc3NBbGllbkJ1bGxldFwiXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBhbmdsZSB0b3dhcmRzIHRoZSB0YXJnZXRcbiAgICAgICAgbGV0IGFuZ2xlID0gUGhhc2VyLk1hdGguQW5nbGUuQmV0d2VlbihcbiAgICAgICAgICB0aGlzLngsXG4gICAgICAgICAgdGhpcy55LFxuICAgICAgICAgIHBsYXllci5zcHJpdGUueCxcbiAgICAgICAgICBwbGF5ZXIuc3ByaXRlLnlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBEZXRlcm1pbmUgdGhlIHNwZWVkIG9mIG1vdmVtZW50XG4gICAgICAgIGxldCBzcGVlZCA9IDM1MDtcblxuICAgICAgICAvLyBEZXRlcm1pbmUgdGhlIHggYW5kIHkgdmVsb2NpdGllc1xuICAgICAgICBsZXQgdmVsb2NpdHlYID0gc3BlZWQgKiBNYXRoLmNvcyhhbmdsZSk7XG4gICAgICAgIGxldCB2ZWxvY2l0eVkgPSBzcGVlZCAqIE1hdGguc2luKGFuZ2xlKTtcblxuICAgICAgICAvLyBTZXQgdGhlc2UgdmVsb2NpdGllc1xuICAgICAgICBib3NzQWxpZW5CdWxsZXQuc2V0VmVsb2NpdHkodmVsb2NpdHlYLCB2ZWxvY2l0eVkpO1xuXG4gICAgICAgIGlmICh0aGlzLmFjdGl2ZSkge1xuICAgICAgICAgIHRoaXMubmV4dFNob290RXZlbnQgPSB0aGlzLnNjZW5lLnRpbWUuZGVsYXllZENhbGwoXG4gICAgICAgICAgICBQaGFzZXIuTWF0aC5CZXR3ZWVuKDI3MCwgdGhpcy5zaG9vdERlbGF5KSxcbiAgICAgICAgICAgIHNob290LFxuICAgICAgICAgICAgW10sXG4gICAgICAgICAgICB0aGlzXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgc2hvb3QoKTtcbiAgICB9XG4gIH1cblxuICAvLyBDcmVhdGUgdGhlIGFsaWVuc1xuICBsZXQgcmVndWxhckFsaWVucyA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoe1xuICAgIGNsYXNzVHlwZTogUmVndWxhckFsaWVuLFxuICB9KTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGdhbWVTZXR0aW5ncy5yZWd1bGFyQWxpZW5zOyBpKyspIHtcbiAgICBsZXQgYWxpZW4gPSByZWd1bGFyQWxpZW5zLmdldCgpO1xuICAgIGFsaWVuLnNldHVwKDEwMCArIDEzMCAqIGksIDEwMCk7XG4gIH1cblxuICAvKlxuICAgKiBVUEdSQURFU1xuICAgKi9cblxuICB1cGdyYWRlcyA9IHRoaXMucGh5c2ljcy5hZGQuZ3JvdXAoKTtcblxuICAvKlxuICAgKiBTT1VORFNcbiAgICovXG4gIGV4cGxvc2lvblNvdW5kID0gdGhpcy5zb3VuZC5hZGQoXCJleHBsb3Npb25Tb3VuZFwiKTtcbiAgc2hvb3RTb3VuZCA9IHRoaXMuc291bmQuYWRkKFwic2hvb3RTb3VuZFwiKTtcbiAgcGxheWVyRGVhZFNvdW5kID0gdGhpcy5zb3VuZC5hZGQoXCJpbXBhY3RTY3JlYW1Tb3VuZFwiKTtcblxuICAvKlxuICAgKlxuICAgKiBERVZFTE9QTUVOVCBUT09MU1xuICAgKlxuICAgKiBFbmFibGUgdGhlc2UgYXMgcXVlcnkgc3RyaW5ncyB3aGVuIG5lZWRlZFxuICAgKiAqXG4gICAqL1xuXG4gIC8vIEFkZCBtdXNpYywgdW5sZXNzIHRoZSB1c2VyIHNhaWQgdGhleSBkb24ndCB3YW50IGl0XG4gIGlmIChwYXJhbXMuZ2V0KFwibm9NdXNpY1wiKSAhPT0gXCJ0cnVlXCIpIHtcbiAgICBpZiAoIWxldmVsMU11c2ljKSB7XG4gICAgICBsZXZlbDFNdXNpYyA9IHRoaXMuc291bmQuYWRkKFwibGV2ZWwxTXVzaWNcIik7XG4gICAgICBsZXZlbDFNdXNpYy5zZXRWb2x1bWUoMC44KTtcbiAgICAgIGxldmVsMU11c2ljLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBpZiAocGFyYW1zLmdldChcImRyb3BVcGdyYWRlc1wiKSA9PT0gXCJ0cnVlXCIpIHtcbiAgICByZWd1bGFyQWxpZW5zLmdldENoaWxkcmVuKClbNV0uZHJvcFVwZ3JhZGUueDIoKTtcbiAgfVxuXG4gIC8qXG4gICAqIEFOSU1BVElPTlNcbiAgICovXG5cbiAgLy8gQWRkIGFuaW1hdGlvbnNcbiAgdGhpcy5hbmltcy5jcmVhdGUoe1xuICAgIGtleTogXCJleHBsb2RlXCIsXG4gICAgZnJhbWVzOiB0aGlzLmFuaW1zLmdlbmVyYXRlRnJhbWVOdW1iZXJzKFwicGxheWVyLTEtZXhwbG9zaW9uXCIsIHtcbiAgICAgIHN0YXJ0OiAwLFxuICAgICAgZW5kOiA4LFxuICAgICAgZmlyc3Q6IDAsXG4gICAgfSksXG4gICAgZnJhbWVSYXRlOiAyMyxcbiAgICByZXBlYXQ6IDAsXG4gICAgaGlkZU9uQ29tcGxldGU6IHRydWUsXG4gIH0pO1xuXG4gIHRoaXMuYW5pbXMuY3JlYXRlKHtcbiAgICBrZXk6IFwiYm9zc0FsaWVuRXhwbG9kZVwiLFxuICAgIGZyYW1lczogdGhpcy5hbmltcy5nZW5lcmF0ZUZyYW1lTnVtYmVycyhcImJvc3MtYWxpZW4tZXhwbG9zaW9uXCIsIHtcbiAgICAgIHN0YXJ0OiAwLFxuICAgICAgZW5kOiAxMCxcbiAgICAgIGZpcnN0OiAwLFxuICAgIH0pLFxuICAgIGZyYW1lUmF0ZTogMjMsXG4gICAgcmVwZWF0OiAwLFxuICAgIGhpZGVPbkNvbXBsZXRlOiB0cnVlLFxuICB9KTtcblxuICAvKlxuICAgKiBPVkVSTEFQU1xuICAgKi9cblxuICAvLyBXaGVuIGEgcGxheWVyIGJ1bGxldCBoaXRzIGFuIGFsaWVuIChvciBsYXRlciwgYSBib3NzIGFsaWVuKVxuICB0aGlzLnBoeXNpY3MuYWRkLm92ZXJsYXAoXG4gICAgcGxheWVyQnVsbGV0cyxcbiAgICByZWd1bGFyQWxpZW5zLFxuICAgIGZ1bmN0aW9uIChwbGF5ZXJCdWxsZXQsIGFsaWVuKSB7XG4gICAgICBwbGF5ZXJCdWxsZXQuZGVzdHJveSgpO1xuICAgICAgZXhwbG9zaW9uU291bmQucGxheSgpO1xuICAgICAgaWYgKGFsaWVuLm5leHRTaG9vdEV2ZW50KSB7XG4gICAgICAgIGFsaWVuLm5leHRTaG9vdEV2ZW50LnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgYWxpZW4uZGVzdHJveSgpO1xuXG4gICAgICAvLyBEcm9wIGFuIHVwZ3JhZGVcbiAgICAgIGxldCBkcm9wVXBncmFkZUNoYW5jZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgMTAwKTtcbiAgICAgIGlmIChkcm9wVXBncmFkZUNoYW5jZSA+IDgwKSB7XG4gICAgICAgIGFsaWVuLmRyb3BVcGdyYWRlLngyKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIExldCdzIHNlZSBpZiBhbGwgcmVndWxhciBhbGllbnMgYXJlIGRlYWRcbiAgICAgIGxldCBhbGllbnNBbGl2ZSA9IGZhbHNlO1xuICAgICAgcmVndWxhckFsaWVucy5nZXRDaGlsZHJlbigpLmZvckVhY2goKGFsaWVuKSA9PiB7XG4gICAgICAgIGlmIChhbGllbi5hY3RpdmUpIHtcbiAgICAgICAgICBhbGllbnNBbGl2ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKGFsaWVuc0FsaXZlID09PSBmYWxzZSAmJiBwbGF5ZXIuc3ByaXRlLmFjdGl2ZSkge1xuICAgICAgICBsZXQgYm9zc0FsaWVuR3JvdXAgPSB0aGlzLnBoeXNpY3MuYWRkLmdyb3VwKHsgY2xhc3NUeXBlOiBCb3NzQWxpZW4gfSk7XG4gICAgICAgIGJvc3NBbGllbiA9IGJvc3NBbGllbkdyb3VwLmdldCgpO1xuICAgICAgICBib3NzQWxpZW4uc2V0dXAoY29uZmlnLndpZHRoIC8gMiwgMTcwKTtcblxuICAgICAgICAvLyBJZiB0aGUgcGxheWVyIGhpdHMgdGhlIGJvc3MgYWxpZW5cbiAgICAgICAgdGhpcy5waHlzaWNzLmFkZC5vdmVybGFwKFxuICAgICAgICAgIGJvc3NBbGllbixcbiAgICAgICAgICBwbGF5ZXJCdWxsZXRzLFxuICAgICAgICAgIGZ1bmN0aW9uIChib3NzQWxpZW4sIHBsYXllckJ1bGxldCkge1xuICAgICAgICAgICAgLy8gRG9uJ3QgYWxsb3cgc2hvb3RpbmcgdGhlIGJvc3Mgd2hpbGUgaXQncyBzcGF3bmluZ1xuXG4gICAgICAgICAgICBwbGF5ZXJCdWxsZXQuZGVzdHJveSgpO1xuXG4gICAgICAgICAgICBpZiAoYm9zc0FsaWVuLnNwYXduaW5nKSByZXR1cm47XG4gICAgICAgICAgICBib3NzQWxpZW4uc2V0TGlmZShib3NzQWxpZW4ubGlmZSAtIDEpO1xuXG4gICAgICAgICAgICBpZiAoYm9zc0FsaWVuLmxpZmUgPT09IDAgJiYgcGxheWVyLnNwcml0ZS5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgYm9zc0FsaWVuLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgYm9zc0FsaWVuLmhlYWx0aEJhci5iYXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgICB0aGlzLnBoeXNpY3MuYWRkXG4gICAgICAgICAgICAgICAgLnNwcml0ZShib3NzQWxpZW4ueCwgYm9zc0FsaWVuLnksIFwiYm9zc0FsaWVuRXhwbG9kZVwiKVxuICAgICAgICAgICAgICAgIC5wbGF5KFwiYm9zc0FsaWVuRXhwbG9kZVwiKTtcbiAgICAgICAgICAgICAgZXhwbG9zaW9uU291bmQucGxheSgpO1xuXG4gICAgICAgICAgICAgIC8vIFNob3cgXCJZb3Ugd2luXCIgdGV4dFxuICAgICAgICAgICAgICBsZXQgdGV4dCA9IHRoaXMuYWRkXG4gICAgICAgICAgICAgICAgLnRleHQoMCwgMCwgXCJZb3Ugd2luIVwiLCB7XG4gICAgICAgICAgICAgICAgICBmb250OiAnNjRweCBcIkFyaWFsIEJsYWNrXCIsIFwiQXJpYWwgQm9sZFwiLCBcIkFyaWFsXCIsIHNhbnMtc2VyaWYnLFxuICAgICAgICAgICAgICAgICAgZmlsbDogXCIjZmZmXCIsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc2V0T3JpZ2luKDAuNSwgMC41KVxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbihjb25maWcud2lkdGggLyAyLCBjb25maWcuaGVpZ2h0IC8gMilcbiAgICAgICAgICAgICAgICAuc2V0VmlzaWJsZShmYWxzZSk7XG5cbiAgICAgICAgICAgICAgdGhpcy50aW1lLmRlbGF5ZWRDYWxsKFxuICAgICAgICAgICAgICAgIDkwMCxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICB0ZXh0LnNldFZpc2libGUodHJ1ZSk7IC8vIGFmdGVyIDMwMG1zLCB0aGUgdGV4dCBiZWNvbWVzIHZpc2libGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFtdLFxuICAgICAgICAgICAgICAgIHRoaXNcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG51bGwsXG4gICAgICAgICAgdGhpc1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgbnVsbCxcbiAgICB0aGlzXG4gICk7XG5cbiAgLy8gV2hlbiB0aGUgcGxheWVyIGlzIGhpdCBieSBhbiBhbGllbiBidWxsZXRcbiAgdGhpcy5waHlzaWNzLmFkZC5vdmVybGFwKFxuICAgIHBsYXllci5zcHJpdGUsXG4gICAgYWxpZW5CdWxsZXRzLFxuICAgIGZ1bmN0aW9uIChwbGF5ZXJTcHJpdGUsIGFsaWVuQnVsbGV0KSB7XG4gICAgICBwbGF5ZXJTcHJpdGUucGxheWVyLmRlY3JlYXNlTGlmZSgxKTtcbiAgICAgIGFsaWVuQnVsbGV0LmRlc3Ryb3koKTtcbiAgICAgIHBsYXllckRlYWRTb3VuZC5wbGF5KCk7XG5cbiAgICAgIGlmIChwbGF5ZXIuaGVhbHRoID4gMCkgcmV0dXJuO1xuXG4gICAgICBhbGllbkJ1bGxldC5kZXN0cm95KCk7XG4gICAgICBwbGF5ZXIuZGVzdHJveSgpO1xuXG4gICAgICBsZXQgeW91TG9zZVRleHQgPSB0aGlzLmFkZFxuICAgICAgICAudGV4dCgwLCAwLCBcIllvdSBsb3NlXCIsIHtcbiAgICAgICAgICBmb250OiAnNjRweCBcIkFyaWFsIEJsYWNrXCIsIFwiQXJpYWwgQm9sZFwiLCBcIkFyaWFsXCIsIHNhbnMtc2VyaWYnLFxuICAgICAgICAgIGZpbGw6IFwiI2ZmZlwiLFxuICAgICAgICB9KVxuICAgICAgICAuc2V0T3JpZ2luKDAuNSwgMC41KVxuICAgICAgICAuc2V0UG9zaXRpb24oY29uZmlnLndpZHRoIC8gMiwgY29uZmlnLmhlaWdodCAvIDIpXG4gICAgICAgIC5zZXRWaXNpYmxlKGZhbHNlKTtcblxuICAgICAgbGV0IHNwYWNlVG9SZXN0YXJ0VGV4dCA9IHRoaXMuYWRkXG4gICAgICAgIC50ZXh0KDAsIDAsIFwiSGl0IDxTcGFjZT4gdG8gcmVzdGFydFwiLCB7XG4gICAgICAgICAgZm9udDogJzM0cHggXCJBcmlhbCBCbGFja1wiLCBcIkFyaWFsIEJvbGRcIiwgXCJBcmlhbFwiLCBzYW5zLXNlcmlmJyxcbiAgICAgICAgICBmaWxsOiBcIiNmZmZcIixcbiAgICAgICAgfSlcbiAgICAgICAgLnNldE9yaWdpbigwLjUsIDAuNSlcbiAgICAgICAgLnNldFBvc2l0aW9uKGNvbmZpZy53aWR0aCAvIDIsIGNvbmZpZy5oZWlnaHQgLyAyICsgMTAwKVxuICAgICAgICAuc2V0VmlzaWJsZShmYWxzZSk7XG5cbiAgICAgIHRoaXMudGltZS5kZWxheWVkQ2FsbChcbiAgICAgICAgNjAwLFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgeW91TG9zZVRleHQuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgfSxcbiAgICAgICAgW10sXG4gICAgICAgIHRoaXNcbiAgICAgICk7XG4gICAgICB0aGlzLnRpbWUuZGVsYXllZENhbGwoXG4gICAgICAgIDIxMDAsXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzcGFjZVRvUmVzdGFydFRleHQuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICBhbGxvd1Jlc3RhcnQgPSB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBbXSxcbiAgICAgICAgdGhpc1xuICAgICAgKTtcbiAgICB9LFxuICAgIG51bGwsXG4gICAgdGhpc1xuICApO1xuXG4gIC8vIFdoZW4gdGhlIHBsYXllciBwaWNrcyB1cCBhbiB1cGdyYWRlXG4gIHRoaXMucGh5c2ljcy5hZGQub3ZlcmxhcChcbiAgICBwbGF5ZXIuc3ByaXRlLFxuICAgIHVwZ3JhZGVzLFxuICAgIGZ1bmN0aW9uIChwbGF5ZXJTcHJpdGUsIHVwZ3JhZGUpIHtcbiAgICAgIHVwZ3JhZGUuZW5hYmxlKHBsYXllclNwcml0ZS5wbGF5ZXIpO1xuICAgICAgdXBncmFkZS5kZXN0cm95KCk7XG5cbiAgICAgIHRoaXMudGltZS5kZWxheWVkQ2FsbChcbiAgICAgICAgMzUwMCxcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHVwZ3JhZGUuZXhwaXJlKHBsYXllclNwcml0ZS5wbGF5ZXIpO1xuICAgICAgICB9LFxuICAgICAgICBbXSxcbiAgICAgICAgdGhpc1xuICAgICAgKTtcbiAgICB9LFxuICAgIG51bGwsXG4gICAgdGhpc1xuICApO1xufVxuXG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gIC8vIE1vdmUgdXNpbmcgdGhlIGFycm93IGtleXNcbiAgaWYgKHBsYXllci5zcHJpdGUuYWN0aXZlKSB7XG4gICAgaWYgKGN1cnNvcnMubGVmdC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5zZXRWZWxvY2l0eVgoLXBsYXllci5zcGVlZCk7XG4gICAgfSBlbHNlIGlmIChjdXJzb3JzLnJpZ2h0LmlzRG93bikge1xuICAgICAgcGxheWVyLnNldFZlbG9jaXR5WChwbGF5ZXIuc3BlZWQpO1xuICAgIH0gZWxzZSBpZiAoY3Vyc29ycy5kb3duLmlzRG93bikge1xuICAgICAgcGxheWVyLnNldFZlbG9jaXR5WShwbGF5ZXIuc3BlZWQpO1xuICAgIH0gZWxzZSBpZiAoY3Vyc29ycy51cC5pc0Rvd24pIHtcbiAgICAgIHBsYXllci5zZXRWZWxvY2l0eVkoLXBsYXllci5zcGVlZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBsYXllci5zZXRWZWxvY2l0eVgoMCk7XG4gICAgICBwbGF5ZXIuc2V0VmVsb2NpdHlZKDApO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNob290IHVzaW5nIHRoZSBzcGFjZSBiYXJcbiAgaWYgKFBoYXNlci5JbnB1dC5LZXlib2FyZC5KdXN0RG93bihjdXJzb3JzLnNwYWNlKSkge1xuICAgIGlmIChwbGF5ZXIuc3ByaXRlLmFjdGl2ZSkge1xuICAgICAgaWYgKHBsYXllci53ZWFwb24gPT09IFwiYnVsbGV0c1wiKSB7XG4gICAgICAgIGxldCBwbGF5ZXJCdWxsZXQgPSBwbGF5ZXJCdWxsZXRzLmNyZWF0ZShcbiAgICAgICAgICBwbGF5ZXIuc3ByaXRlLngsXG4gICAgICAgICAgcGxheWVyLnNwcml0ZS55IC0gcGxheWVyLnNwcml0ZS5oZWlnaHQgKyA0MCxcbiAgICAgICAgICBcInBsYXllckJ1bGxldFwiXG4gICAgICAgICk7XG4gICAgICAgIHBsYXllckJ1bGxldC5zZXRWZWxvY2l0eVkoLXBsYXllci5zcGVlZCk7XG4gICAgICAgIHNob290U291bmQucGxheSgpO1xuICAgICAgfSBlbHNlIGlmIChwbGF5ZXIud2VhcG9uID09PSBcImRvdWJsZS1idWxsZXRzXCIpIHtcbiAgICAgICAgbGV0IHBsYXllckJ1bGxldDEgPSBwbGF5ZXJCdWxsZXRzLmNyZWF0ZShcbiAgICAgICAgICBwbGF5ZXIuc3ByaXRlLnggLSAyMCxcbiAgICAgICAgICBwbGF5ZXIuc3ByaXRlLnkgLSBwbGF5ZXIuc3ByaXRlLmhlaWdodCArIDQwLFxuICAgICAgICAgIFwicGxheWVyQnVsbGV0XCJcbiAgICAgICAgKTtcbiAgICAgICAgcGxheWVyQnVsbGV0MS5zZXRWZWxvY2l0eVkoLXBsYXllci5zcGVlZCk7XG4gICAgICAgIGxldCBwbGF5ZXJCdWxsZXQyID0gcGxheWVyQnVsbGV0cy5jcmVhdGUoXG4gICAgICAgICAgcGxheWVyLnNwcml0ZS54ICsgMjAsXG4gICAgICAgICAgcGxheWVyLnNwcml0ZS55IC0gcGxheWVyLnNwcml0ZS5oZWlnaHQgKyA0MCxcbiAgICAgICAgICBcInBsYXllckJ1bGxldFwiXG4gICAgICAgICk7XG4gICAgICAgIHBsYXllckJ1bGxldDIuc2V0VmVsb2NpdHlZKC1wbGF5ZXIuc3BlZWQpO1xuICAgICAgICBzaG9vdFNvdW5kLnBsYXkoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGFsbG93UmVzdGFydCkge1xuICAgICAgICAvLyBSZXN0YXJ0IHRoZSBnYW1lXG4gICAgICAgIGFsbG93UmVzdGFydCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNjZW5lLnJlc3RhcnQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBNb3ZlIHRoZSB0ZXh0dXJlIG9mIHRoZSB0aWxlIHNwcml0ZSB1cHdhcmRzXG4gIGJnLnRpbGVQb3NpdGlvblkgLT0gMS4xO1xufVxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJnIiwiZ2xvYmFsVGhpcyIsInRoaXMiLCJGdW5jdGlvbiIsImUiLCJ3aW5kb3ciLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwibG9jYXRpb24iLCJkb2N1bWVudCIsImN1cnJlbnRTY3JpcHQiLCJzcmMiLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJsZW5ndGgiLCJpIiwiRXJyb3IiLCJyZXBsYWNlIiwicCIsImNvbnN0cnVjdG9yIiwic2NlbmUiLCJ4IiwieSIsIm1heExpZmUiLCJ3aWR0aCIsImhlaWdodCIsImJhciIsIlBoYXNlciIsIkdhbWVPYmplY3RzIiwiR3JhcGhpY3MiLCJjdXJyZW50SGVhbHRoIiwicGVyY2VudCIsImRyYXciLCJhZGQiLCJleGlzdGluZyIsImRlY3JlYXNlIiwiYW1vdW50IiwiY2xlYXIiLCJmaWxsU3R5bGUiLCJmaWxsUmVjdCIsImQiLCJNYXRoIiwiZmxvb3IiLCJtYXhMaXZlcyIsImN1cnJlbnRMaXZlcyIsImhlYXJ0cyIsImdyb3VwIiwia2V5IiwicmVwZWF0Iiwic2V0WFkiLCJzdGVwWCIsImdldENoaWxkcmVuIiwiZm9yRWFjaCIsImhlYXJ0IiwiaW5kZXgiLCJzZXRWaXNpYmxlIiwicGxheWVyU3BlZWQiLCJwbGF5ZXJXZWFwb24iLCJwbGF5ZXJIZWFsdGgiLCJzcGVlZCIsIndlYXBvbiIsImhlYWx0aCIsInNwcml0ZSIsInBoeXNpY3MiLCJzZXRDb2xsaWRlV29ybGRCb3VuZHMiLCJwbGF5ZXIiLCJleHBsb3Npb24iLCJzZXRTcGVlZCIsInNldFdlYXBvbnMiLCJzZXRWZWxvY2l0eVgiLCJ2ZWxvY2l0eSIsInNldFZlbG9jaXR5WSIsImRlY3JlYXNlTGlmZSIsImFsZXJ0IiwidHdlZW5zIiwidGFyZ2V0cyIsIkJldHdlZW4iLCJkdXJhdGlvbiIsImVhc2UiLCJhbHBoYSIsInlveW8iLCJkZXN0cm95IiwicGxheSIsImNvbmZpZyIsInR5cGUiLCJBVVRPIiwiZGVmYXVsdCIsImFyY2FkZSIsImdyYXZpdHkiLCJwcmVsb2FkIiwibG9hZCIsImltYWdlIiwiYXVkaW8iLCJzcHJpdGVzaGVldCIsImZyYW1lV2lkdGgiLCJmcmFtZUhlaWdodCIsImVuZEZyYW1lIiwiY3JlYXRlIiwiYmciLCJ0aWxlU3ByaXRlIiwic2V0T3JpZ2luIiwiZ2FtZVNldHRpbmdzIiwiY3Vyc29ycyIsImlucHV0Iiwia2V5Ym9hcmQiLCJjcmVhdGVDdXJzb3JLZXlzIiwiYWxpZW5CdWxsZXRzIiwicGxheWVyQnVsbGV0cyIsIkFsaWVuIiwiUGh5c2ljcyIsIkFyY2FkZSIsIlNwcml0ZSIsInRleHR1cmUiLCJzaG9vdERlbGF5IiwibW92ZW1lbnRTcGVlZCIsInNwYXduaW5nIiwic3VwZXIiLCJ3b3JsZCIsImVuYWJsZSIsInN0YXJ0U2hvb3RpbmciLCJzdGFydE1vdmluZyIsImRyb3BVcGdyYWRlIiwieDIiLCJ1cGdyYWRlIiwidXBncmFkZXMiLCJleHBpcmUiLCJzZXR1cCIsInNldFBvc2l0aW9uIiwic2V0QWN0aXZlIiwicGFyYW1zIiwiZ2V0Iiwic2hvb3QiLCJhY3RpdmUiLCJuZXh0U2hvb3RFdmVudCIsInRpbWUiLCJkZWxheWVkQ2FsbCIsImluaXRpYWxEZWxheSIsIm1vdmUiLCJkaXJlY3Rpb24iLCJkaXN0YW5jZSIsInRhcmdldCIsImdhbWUiLCJoZWFsdGhCYXIiLCJvbkNvbXBsZXRlIiwibW92ZW1lbnREZWxheSIsIm5leHRNb3ZlRXZlbnQiLCJCb3NzQWxpZW4iLCJsaWZlIiwic2V0TGlmZSIsInZhbHVlIiwiYm9zc0FsaWVuQnVsbGV0IiwiYW5nbGUiLCJBbmdsZSIsInZlbG9jaXR5WCIsImNvcyIsInZlbG9jaXR5WSIsInNpbiIsInNldFZlbG9jaXR5IiwicmVndWxhckFsaWVucyIsImNsYXNzVHlwZSIsImV4cGxvc2lvblNvdW5kIiwic291bmQiLCJzaG9vdFNvdW5kIiwicGxheWVyRGVhZFNvdW5kIiwibGV2ZWwxTXVzaWMiLCJzZXRWb2x1bWUiLCJhbmltcyIsImZyYW1lcyIsImdlbmVyYXRlRnJhbWVOdW1iZXJzIiwic3RhcnQiLCJlbmQiLCJmaXJzdCIsImZyYW1lUmF0ZSIsImhpZGVPbkNvbXBsZXRlIiwib3ZlcmxhcCIsInBsYXllckJ1bGxldCIsImFsaWVuIiwicmVtb3ZlIiwiYWxpZW5zQWxpdmUiLCJib3NzQWxpZW5Hcm91cCIsImJvc3NBbGllbiIsInRleHQiLCJmb250IiwiZmlsbCIsInBsYXllclNwcml0ZSIsImFsaWVuQnVsbGV0IiwieW91TG9zZVRleHQiLCJzcGFjZVRvUmVzdGFydFRleHQiLCJhbGxvd1Jlc3RhcnQiLCJ1cGRhdGUiLCJsZWZ0IiwiaXNEb3duIiwicmlnaHQiLCJkb3duIiwidXAiLCJJbnB1dCIsIktleWJvYXJkIiwiSnVzdERvd24iLCJzcGFjZSIsInJlc3RhcnQiLCJ0aWxlUG9zaXRpb25ZIiwiVVJMU2VhcmNoUGFyYW1zIiwic2VhcmNoIiwiR2FtZSJdLCJzb3VyY2VSb290IjoiIn0=